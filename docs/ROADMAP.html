<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini-SBR Roadmap</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: #e0e0e0;
        }
        .container { max-width: 1200px; margin: 0 auto; }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00d9ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        /* Progress Overview */
        .progress-overview {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 40px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .progress-bar {
            height: 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d9ff, #00ff88);
            border-radius: 6px;
            width: 0%;
            transition: width 0.3s;
        }
        .progress-stats {
            display: flex;
            justify-content: space-between;
            color: #888;
            font-size: 0.9rem;
        }

        /* Phase Cards */
        .phase {
            background: rgba(255,255,255,0.03);
            border-radius: 16px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.08);
            overflow: hidden;
        }
        .phase-header {
            padding: 20px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .phase-header:hover { background: rgba(255,255,255,0.02); }

        .phase-number {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        .phase-1 .phase-number { background: linear-gradient(135deg, #ff6b6b, #ff8e8e); }
        .phase-2 .phase-number { background: linear-gradient(135deg, #ffd93d, #ffe066); color: #333; }
        .phase-3 .phase-number { background: linear-gradient(135deg, #6bcb77, #8edd96); color: #333; }
        .phase-4 .phase-number { background: linear-gradient(135deg, #4d96ff, #6ba8ff); }
        .phase-5 .phase-number { background: linear-gradient(135deg, #9b59b6, #b07cc6); }

        .phase-info { flex: 1; }
        .phase-title { font-size: 1.3rem; font-weight: 600; margin-bottom: 4px; }
        .phase-desc { color: #888; font-size: 0.9rem; }

        .phase-status {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .status-pending { background: rgba(255,255,255,0.1); color: #888; }
        .status-progress { background: rgba(255,193,7,0.2); color: #ffc107; }
        .status-done { background: rgba(0,255,136,0.2); color: #00ff88; }

        /* Tasks */
        .phase-content {
            padding: 0 24px 24px;
            display: none;
        }
        .phase.expanded .phase-content { display: block; }

        .task-group {
            margin-bottom: 20px;
        }
        .task-group-title {
            font-size: 0.85rem;
            color: #00d9ff;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .task {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .task:last-child { border-bottom: none; }

        .task-check {
            width: 22px;
            height: 22px;
            border-radius: 6px;
            border: 2px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
            margin-top: 2px;
            transition: all 0.2s;
        }
        .task-check:hover { border-color: #00ff88; }
        .task-check.checked {
            background: #00ff88;
            border-color: #00ff88;
        }
        .task-check.checked::after {
            content: '✓';
            color: #1a1a2e;
            font-weight: bold;
            font-size: 14px;
        }

        .task-content { flex: 1; }
        .task-title { font-size: 0.95rem; margin-bottom: 4px; }
        .task.done .task-title {
            color: #666;
            text-decoration: line-through;
        }
        .task-detail {
            font-size: 0.8rem;
            color: #666;
            font-family: 'Monaco', 'Consolas', monospace;
            background: rgba(0,0,0,0.2);
            padding: 8px 12px;
            border-radius: 6px;
            margin-top: 8px;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .task-tag {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
            color: #888;
        }
        .tag-learn { background: rgba(0,217,255,0.2); color: #00d9ff; }
        .tag-pattern { background: rgba(155,89,182,0.2); color: #b07cc6; }
        .tag-new { background: rgba(0,255,136,0.2); color: #00ff88; }

        /* Code Examples */
        .code-example {
            background: #0d1117;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            overflow-x: auto;
        }
        .code-example code {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85rem;
            color: #c9d1d9;
            white-space: pre;
        }
        .code-comment { color: #8b949e; }
        .code-keyword { color: #ff7b72; }
        .code-string { color: #a5d6ff; }
        .code-class { color: #ffa657; }

        /* Toggle Arrow */
        .toggle-arrow {
            color: #666;
            transition: transform 0.2s;
        }
        .phase.expanded .toggle-arrow { transform: rotate(180deg); }

        /* Learning Notes */
        .learning-note {
            background: rgba(0,217,255,0.1);
            border-left: 3px solid #00d9ff;
            padding: 12px 16px;
            margin: 16px 0;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
        }
        .learning-note strong { color: #00d9ff; }

        /* Requirements Section */
        .requirements {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 20px;
            margin-top: 40px;
        }
        .requirements h3 {
            color: #00d9ff;
            margin-bottom: 16px;
        }
        .req-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 8px;
        }
        .req-item {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85rem;
            color: #888;
            padding: 8px 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
        }
        .req-item span { color: #00ff88; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mini-SBR Development Roadmap</h1>
        <p class="subtitle">AI-Powered Recruitment Platform - Complete Code Guide</p>

        <!-- Progress Overview -->
        <div class="progress-overview">
            <h3>Overall Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <div class="progress-stats">
                <span><span id="completedTasks">0</span> / <span id="totalTasks">0</span> tasks completed</span>
                <span id="progressPercent">0%</span>
            </div>
        </div>

        <!-- Phase 1: Setup -->
        <div class="phase phase-1 expanded">
            <div class="phase-header" onclick="togglePhase(this)">
                <div class="phase-number">1</div>
                <div class="phase-info">
                    <div class="phase-title">Project Setup & Foundation</div>
                    <div class="phase-desc">Django project structure, settings, and base patterns</div>
                </div>
                <span class="phase-status status-pending">Not Started</span>
                <span class="toggle-arrow">▼</span>
            </div>
            <div class="phase-content">
                <div class="learning-note">
                    <strong>What You'll Learn:</strong> Django project structure, settings configuration,
                    virtual environments, and the BaseModel pattern used in production apps.
                </div>

                <div class="task-group">
                    <div class="task-group-title">Project Initialization</div>

                    <div class="task" data-task="1">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create virtual environment and install Django</div>
                            <div class="task-detail">python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install django</div>
                        </div>
                    </div>

                    <div class="task" data-task="2">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create Django project: mini_sbr</div>
                            <div class="task-detail">django-admin startproject mini_sbr .</div>
                        </div>
                    </div>

                    <div class="task" data-task="3">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create libs/ directory</div>
                            <div class="task-detail">mkdir libs
touch libs/__init__.py</div>
                        </div>
                    </div>
                </div>

                <div class="task-group">
                    <div class="task-group-title">Install Dependencies</div>

                    <div class="task" data-task="4">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create requirements.txt</div>
                            <div class="code-example"><code><span class="code-comment"># requirements.txt</span>
Django==5.0.1
djangorestframework==3.14.0
djangorestframework-simplejwt==5.3.1
django-cors-headers==4.3.1
django-filter==23.5
django-environ==0.11.2
drf-spectacular==0.27.0
Pillow==10.2.0

<span class="code-comment"># Development</span>
black==24.1.0
isort==5.13.2
flake8==7.0.0</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="5">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Install all dependencies</div>
                            <div class="task-detail">pip install -r requirements.txt</div>
                        </div>
                    </div>
                </div>

                <div class="task-group">
                    <div class="task-group-title">BaseModel Pattern <span class="task-tag tag-pattern">Pattern</span></div>

                    <div class="task" data-task="6">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create libs/base_models.py <span class="task-tag tag-learn">Learn</span></div>
                            <div class="code-example"><code><span class="code-comment"># libs/base_models.py</span>
<span class="code-keyword">from</span> django.db <span class="code-keyword">import</span> models
<span class="code-keyword">from</span> django.conf <span class="code-keyword">import</span> settings
<span class="code-keyword">from</span> django.utils <span class="code-keyword">import</span> timezone


<span class="code-keyword">class</span> <span class="code-class">BaseModel</span>(models.Model):
    <span class="code-string">"""
    Base model with audit trail and soft deletes.
    All models should inherit from this.
    """</span>

    <span class="code-comment"># Audit fields - WHO did what</span>
    created_by = models.ForeignKey(
        settings.AUTH_USER_MODEL,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name=<span class="code-string">'%(class)s_created'</span>
    )
    updated_by = models.ForeignKey(
        settings.AUTH_USER_MODEL,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name=<span class="code-string">'%(class)s_updated'</span>
    )
    deleted_by = models.ForeignKey(
        settings.AUTH_USER_MODEL,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name=<span class="code-string">'%(class)s_deleted'</span>
    )

    <span class="code-comment"># Timestamp fields - WHEN it happened</span>
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    deleted_at = models.DateTimeField(null=True, blank=True)

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        abstract = True

    <span class="code-keyword">def</span> soft_delete(self, user=None):
        <span class="code-string">"""Mark record as deleted without removing from DB"""</span>
        self.deleted_at = timezone.now()
        self.deleted_by = user
        self.save(update_fields=[<span class="code-string">'deleted_at'</span>, <span class="code-string">'deleted_by'</span>])

    <span class="code-keyword">def</span> restore(self):
        <span class="code-string">"""Restore a soft-deleted record"""</span>
        self.deleted_at = None
        self.deleted_by = None
        self.save(update_fields=[<span class="code-string">'deleted_at'</span>, <span class="code-string">'deleted_by'</span>])</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="7">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create libs/managers.py <span class="task-tag tag-learn">Learn</span></div>
                            <div class="code-example"><code><span class="code-comment"># libs/managers.py</span>
<span class="code-keyword">from</span> django.db <span class="code-keyword">import</span> models


<span class="code-keyword">class</span> <span class="code-class">SoftDeleteManager</span>(models.Manager):
    <span class="code-string">"""
    Manager that filters out soft-deleted records.
    Use as: objects = SoftDeleteManager()
    """</span>

    <span class="code-keyword">def</span> get_queryset(self):
        <span class="code-keyword">return</span> super().get_queryset().filter(deleted_at__isnull=True)


<span class="code-keyword">class</span> <span class="code-class">AllObjectsManager</span>(models.Manager):
    <span class="code-string">"""
    Manager that includes ALL records (even deleted).
    Use as: all_objects = AllObjectsManager()
    """</span>
    <span class="code-keyword">pass</span>


<span class="code-comment"># Usage in any model:
# class MyModel(BaseModel):
#     objects = SoftDeleteManager()      # MyModel.objects.all() = only active
#     all_objects = AllObjectsManager()  # MyModel.all_objects.all() = include deleted</span></code></div>
                        </div>
                    </div>
                </div>

                <div class="task-group">
                    <div class="task-group-title">Environment & Settings</div>

                    <div class="task" data-task="8">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create .env file</div>
                            <div class="code-example"><code><span class="code-comment"># .env</span>
DEBUG=True
SECRET_KEY=your-super-secret-key-change-in-production-123
DATABASE_URL=sqlite:///db.sqlite3</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="9">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Update mini_sbr/settings.py (FULL FILE) <span class="task-tag tag-learn">Learn</span></div>
                            <div class="code-example"><code><span class="code-comment"># mini_sbr/settings.py</span>
<span class="code-keyword">from</span> pathlib <span class="code-keyword">import</span> Path
<span class="code-keyword">import</span> environ
<span class="code-keyword">from</span> datetime <span class="code-keyword">import</span> timedelta

<span class="code-comment"># Build paths</span>
BASE_DIR = Path(__file__).resolve().parent.parent

<span class="code-comment"># Environment variables</span>
env = environ.Env()
environ.Env.read_env(BASE_DIR / <span class="code-string">'.env'</span>)

<span class="code-comment"># Security</span>
SECRET_KEY = env(<span class="code-string">'SECRET_KEY'</span>)
DEBUG = env.bool(<span class="code-string">'DEBUG'</span>, default=False)
ALLOWED_HOSTS = [<span class="code-string">'*'</span>]

<span class="code-comment"># Application definition</span>
INSTALLED_APPS = [
    <span class="code-string">'django.contrib.admin'</span>,
    <span class="code-string">'django.contrib.auth'</span>,
    <span class="code-string">'django.contrib.contenttypes'</span>,
    <span class="code-string">'django.contrib.sessions'</span>,
    <span class="code-string">'django.contrib.messages'</span>,
    <span class="code-string">'django.contrib.staticfiles'</span>,
    <span class="code-comment"># Third party</span>
    <span class="code-string">'rest_framework'</span>,
    <span class="code-string">'rest_framework_simplejwt'</span>,
    <span class="code-string">'corsheaders'</span>,
    <span class="code-string">'django_filters'</span>,
    <span class="code-string">'drf_spectacular'</span>,
    <span class="code-comment"># Local apps</span>
    <span class="code-string">'users'</span>,
    <span class="code-string">'companies'</span>,
    <span class="code-string">'candidates'</span>,
    <span class="code-string">'jobs'</span>,
    <span class="code-string">'applications'</span>,
    <span class="code-string">'dashboard'</span>,
]

MIDDLEWARE = [
    <span class="code-string">'corsheaders.middleware.CorsMiddleware'</span>,
    <span class="code-string">'django.middleware.security.SecurityMiddleware'</span>,
    <span class="code-string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,
    <span class="code-string">'django.middleware.common.CommonMiddleware'</span>,
    <span class="code-string">'django.middleware.csrf.CsrfViewMiddleware'</span>,
    <span class="code-string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,
    <span class="code-string">'django.contrib.messages.middleware.MessageMiddleware'</span>,
    <span class="code-string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,
]

ROOT_URLCONF = <span class="code-string">'mini_sbr.urls'</span>

TEMPLATES = [
    {
        <span class="code-string">'BACKEND'</span>: <span class="code-string">'django.template.backends.django.DjangoTemplates'</span>,
        <span class="code-string">'DIRS'</span>: [],
        <span class="code-string">'APP_DIRS'</span>: True,
        <span class="code-string">'OPTIONS'</span>: {
            <span class="code-string">'context_processors'</span>: [
                <span class="code-string">'django.template.context_processors.debug'</span>,
                <span class="code-string">'django.template.context_processors.request'</span>,
                <span class="code-string">'django.contrib.auth.context_processors.auth'</span>,
                <span class="code-string">'django.contrib.messages.context_processors.messages'</span>,
            ],
        },
    },
]

WSGI_APPLICATION = <span class="code-string">'mini_sbr.wsgi.application'</span>

<span class="code-comment"># Database</span>
DATABASES = {
    <span class="code-string">'default'</span>: {
        <span class="code-string">'ENGINE'</span>: <span class="code-string">'django.db.backends.sqlite3'</span>,
        <span class="code-string">'NAME'</span>: BASE_DIR / <span class="code-string">'db.sqlite3'</span>,
    }
}

<span class="code-comment"># Password validation</span>
AUTH_PASSWORD_VALIDATORS = [
    {<span class="code-string">'NAME'</span>: <span class="code-string">'django.contrib.auth.password_validation.MinimumLengthValidator'</span>},
]

<span class="code-comment"># Internationalization</span>
LANGUAGE_CODE = <span class="code-string">'en-us'</span>
TIME_ZONE = <span class="code-string">'UTC'</span>
USE_I18N = True
USE_TZ = True

<span class="code-comment"># Static files</span>
STATIC_URL = <span class="code-string">'static/'</span>

<span class="code-comment"># Media files (uploads)</span>
MEDIA_URL = <span class="code-string">'/media/'</span>
MEDIA_ROOT = BASE_DIR / <span class="code-string">'media'</span>

<span class="code-comment"># Default primary key</span>
DEFAULT_AUTO_FIELD = <span class="code-string">'django.db.models.BigAutoField'</span>

<span class="code-comment"># Custom User model</span>
AUTH_USER_MODEL = <span class="code-string">'users.User'</span>

<span class="code-comment"># CORS (allow all in development)</span>
CORS_ALLOW_ALL_ORIGINS = True

<span class="code-comment"># REST Framework</span>
REST_FRAMEWORK = {
    <span class="code-string">'DEFAULT_AUTHENTICATION_CLASSES'</span>: [
        <span class="code-string">'rest_framework_simplejwt.authentication.JWTAuthentication'</span>,
    ],
    <span class="code-string">'DEFAULT_PERMISSION_CLASSES'</span>: [
        <span class="code-string">'rest_framework.permissions.IsAuthenticated'</span>,
    ],
    <span class="code-string">'DEFAULT_FILTER_BACKENDS'</span>: [
        <span class="code-string">'django_filters.rest_framework.DjangoFilterBackend'</span>,
        <span class="code-string">'rest_framework.filters.SearchFilter'</span>,
        <span class="code-string">'rest_framework.filters.OrderingFilter'</span>,
    ],
    <span class="code-string">'DEFAULT_PAGINATION_CLASS'</span>: <span class="code-string">'rest_framework.pagination.PageNumberPagination'</span>,
    <span class="code-string">'PAGE_SIZE'</span>: 20,
    <span class="code-string">'DEFAULT_SCHEMA_CLASS'</span>: <span class="code-string">'drf_spectacular.openapi.AutoSchema'</span>,
}

<span class="code-comment"># JWT Settings</span>
SIMPLE_JWT = {
    <span class="code-string">'ACCESS_TOKEN_LIFETIME'</span>: timedelta(minutes=60),
    <span class="code-string">'REFRESH_TOKEN_LIFETIME'</span>: timedelta(days=7),
}

<span class="code-comment"># API Documentation</span>
SPECTACULAR_SETTINGS = {
    <span class="code-string">'TITLE'</span>: <span class="code-string">'Mini-SBR API'</span>,
    <span class="code-string">'DESCRIPTION'</span>: <span class="code-string">'AI-Powered Recruitment Platform'</span>,
    <span class="code-string">'VERSION'</span>: <span class="code-string">'1.0.0'</span>,
}</code></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 2: Users App -->
        <div class="phase phase-2">
            <div class="phase-header" onclick="togglePhase(this)">
                <div class="phase-number">2</div>
                <div class="phase-info">
                    <div class="phase-title">Users App & Authentication</div>
                    <div class="phase-desc">Custom User model, JWT auth, registration, login</div>
                </div>
                <span class="phase-status status-pending">Not Started</span>
                <span class="toggle-arrow">▼</span>
            </div>
            <div class="phase-content">
                <div class="learning-note">
                    <strong>What You'll Learn:</strong> Custom User model with phone-based login, JWT tokens,
                    serializers for read/write operations, and ViewSets.
                </div>

                <div class="task-group">
                    <div class="task-group-title">Create Users App</div>

                    <div class="task" data-task="10">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create users app</div>
                            <div class="task-detail">python manage.py startapp users</div>
                        </div>
                    </div>

                    <div class="task" data-task="11">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Update users/apps.py</div>
                            <div class="code-example"><code><span class="code-comment"># users/apps.py</span>
<span class="code-keyword">from</span> django.apps <span class="code-keyword">import</span> AppConfig


<span class="code-keyword">class</span> <span class="code-class">UsersConfig</span>(AppConfig):
    default_auto_field = <span class="code-string">'django.db.models.BigAutoField'</span>
    name = <span class="code-string">'users'</span>  <span class="code-comment"># Important: full path</span></code></div>
                        </div>
                    </div>

                    <div class="task" data-task="12">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create users/models.py <span class="task-tag tag-learn">Learn</span></div>
                            <div class="code-example"><code><span class="code-comment"># users/models.py</span>
<span class="code-comment"># Phone-based authentication</span>
<span class="code-keyword">from</span> django.contrib.auth.models <span class="code-keyword">import</span> AbstractUser, BaseUserManager
<span class="code-keyword">from</span> django.db <span class="code-keyword">import</span> models


<span class="code-keyword">class</span> <span class="code-class">UserRole</span>(models.TextChoices):
    <span class="code-string">"""User roles for access control"""</span>
    ADMIN = <span class="code-string">'ADMIN'</span>, <span class="code-string">'Admin'</span>
    COMPANY = <span class="code-string">'COMPANY'</span>, <span class="code-string">'Company'</span>
    CANDIDATE = <span class="code-string">'CANDIDATE'</span>, <span class="code-string">'Candidate'</span>


<span class="code-keyword">class</span> <span class="code-class">UserManager</span>(BaseUserManager):
    <span class="code-string">"""Custom manager for User model with PHONE as identifier"""</span>

    <span class="code-keyword">def</span> create_user(self, phone, password=None, **extra_fields):
        <span class="code-comment"># Phone is the primary identifier, not email</span>
        <span class="code-keyword">if not</span> phone:
            <span class="code-keyword">raise</span> ValueError(<span class="code-string">'Phone number is required'</span>)
        user = self.model(phone=phone, **extra_fields)
        user.set_password(password)
        user.save(using=self._db)
        <span class="code-keyword">return</span> user

    <span class="code-keyword">def</span> create_superuser(self, phone, password=None, **extra_fields):
        extra_fields.setdefault(<span class="code-string">'is_staff'</span>, True)
        extra_fields.setdefault(<span class="code-string">'is_superuser'</span>, True)
        extra_fields.setdefault(<span class="code-string">'role'</span>, UserRole.ADMIN)
        <span class="code-keyword">return</span> self.create_user(phone, password, **extra_fields)


<span class="code-keyword">class</span> <span class="code-class">User</span>(AbstractUser):
    <span class="code-string">"""
    Custom User model with PHONE login.

    Why phone instead of email?
    -  targets Saudi Arabia B2B market
    - Phone numbers are more reliable for OTP verification
    - Many business users prefer phone-based login
    """</span>

    <span class="code-comment"># Remove username, use phone instead</span>
    username = None

    <span class="code-comment"># Primary identifier - PHONE</span>
    phone = models.CharField(<span class="code-string">'phone number'</span>, max_length=15, unique=True)

    <span class="code-comment"># Email is optional</span>
    email = models.EmailField(<span class="code-string">'email address'</span>, blank=True, null=True)

    <span class="code-comment"># Role for access control</span>
    role = models.CharField(
        max_length=20,
        choices=UserRole.choices,
        default=UserRole.CANDIDATE
    )

    <span class="code-comment"># IMPORTANT: Phone is the login field</span>
    USERNAME_FIELD = <span class="code-string">'phone'</span>
    REQUIRED_FIELDS = []  <span class="code-comment"># No additional required fields for createsuperuser</span>

    objects = UserManager()

    <span class="code-keyword">def</span> __str__(self):
        <span class="code-keyword">return</span> self.phone

    <span class="code-comment"># Helper methods to check role</span>
    <span class="code-keyword">def</span> is_admin_user(self):
        <span class="code-keyword">return</span> self.role == UserRole.ADMIN

    <span class="code-keyword">def</span> is_company_user(self):
        <span class="code-keyword">return</span> self.role == UserRole.COMPANY

    <span class="code-keyword">def</span> is_candidate_user(self):
        <span class="code-keyword">return</span> self.role == UserRole.CANDIDATE</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="13">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create and run migrations</div>
                            <div class="task-detail">python manage.py makemigrations users
python manage.py migrate</div>
                        </div>
                    </div>
                </div>

                <div class="task-group">
                    <div class="task-group-title">User Serializers</div>

                    <div class="task" data-task="14">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create users/serializers.py <span class="task-tag tag-learn">Learn</span></div>
                            <div class="code-example"><code><span class="code-comment"># users/serializers.py</span>
<span class="code-comment"># Phone-based auth serializers</span>
<span class="code-keyword">from</span> rest_framework <span class="code-keyword">import</span> serializers
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> User


<span class="code-keyword">class</span> <span class="code-class">UserReadSerializer</span>(serializers.ModelSerializer):
    <span class="code-string">"""Serializer for reading user data (safe to expose)"""</span>

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = User
        fields = [<span class="code-string">'id'</span>, <span class="code-string">'phone'</span>, <span class="code-string">'email'</span>, <span class="code-string">'role'</span>, <span class="code-string">'first_name'</span>, <span class="code-string">'last_name'</span>,
                  <span class="code-string">'is_active'</span>, <span class="code-string">'date_joined'</span>]
        read_only_fields = fields


<span class="code-keyword">class</span> <span class="code-class">RegisterSerializer</span>(serializers.ModelSerializer):
    <span class="code-string">"""
    Serializer for user registration.

    Phone is the primary identifier.
    Email is optional.
    """</span>

    password = serializers.CharField(
        write_only=True,
        min_length=8,
        style={<span class="code-string">'input_type'</span>: <span class="code-string">'password'</span>}
    )
    password_confirm = serializers.CharField(
        write_only=True,
        style={<span class="code-string">'input_type'</span>: <span class="code-string">'password'</span>}
    )

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = User
        <span class="code-comment"># Phone is required, email is optional</span>
        fields = [<span class="code-string">'phone'</span>, <span class="code-string">'email'</span>, <span class="code-string">'password'</span>, <span class="code-string">'password_confirm'</span>, <span class="code-string">'role'</span>,
                  <span class="code-string">'first_name'</span>, <span class="code-string">'last_name'</span>]

    <span class="code-keyword">def</span> validate_phone(self, value):
        <span class="code-string">"""Validate phone number format"""</span>
        <span class="code-comment"># Simple validation - you could use phonenumbers library for better validation</span>
        <span class="code-keyword">if</span> <span class="code-keyword">not</span> value.replace(<span class="code-string">'+'</span>, <span class="code-string">''</span>).isdigit():
            <span class="code-keyword">raise</span> serializers.ValidationError(<span class="code-string">'Phone must contain only digits'</span>)
        <span class="code-keyword">if</span> len(value) &lt; 9:
            <span class="code-keyword">raise</span> serializers.ValidationError(<span class="code-string">'Phone number too short'</span>)
        <span class="code-keyword">return</span> value

    <span class="code-keyword">def</span> validate(self, data):
        <span class="code-string">"""Check that passwords match"""</span>
        <span class="code-keyword">if</span> data[<span class="code-string">'password'</span>] != data[<span class="code-string">'password_confirm'</span>]:
            <span class="code-keyword">raise</span> serializers.ValidationError({
                <span class="code-string">'password_confirm'</span>: <span class="code-string">"Passwords don't match"</span>
            })
        <span class="code-keyword">return</span> data

    <span class="code-keyword">def</span> create(self, validated_data):
        <span class="code-string">"""Create user with hashed password"""</span>
        validated_data.pop(<span class="code-string">'password_confirm'</span>)
        user = User.objects.create_user(**validated_data)
        <span class="code-keyword">return</span> user


<span class="code-keyword">class</span> <span class="code-class">UserUpdateSerializer</span>(serializers.ModelSerializer):
    <span class="code-string">"""Serializer for updating user profile"""</span>

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = User
        fields = [<span class="code-string">'email'</span>, <span class="code-string">'first_name'</span>, <span class="code-string">'last_name'</span>]</code></div>
                        </div>
                    </div>
                </div>

                <div class="task-group">
                    <div class="task-group-title">User Views</div>

                    <div class="task" data-task="15">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create users/views.py</div>
                            <div class="code-example"><code><span class="code-comment"># users/views.py</span>
<span class="code-keyword">from</span> rest_framework <span class="code-keyword">import</span> generics, permissions, status
<span class="code-keyword">from</span> rest_framework.response <span class="code-keyword">import</span> Response
<span class="code-keyword">from</span> rest_framework.views <span class="code-keyword">import</span> APIView
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> User
<span class="code-keyword">from</span> .serializers <span class="code-keyword">import</span> (
    UserReadSerializer,
    RegisterSerializer,
    UserUpdateSerializer
)


<span class="code-keyword">class</span> <span class="code-class">RegisterView</span>(generics.CreateAPIView):
    <span class="code-string">"""
    Register a new user.
    POST /api/auth/register/
    """</span>
    queryset = User.objects.all()
    serializer_class = RegisterSerializer
    permission_classes = [permissions.AllowAny]

    <span class="code-keyword">def</span> create(self, request, *args, **kwargs):
        serializer = self.get_serializer(data=request.data)
        serializer.is_valid(raise_exception=True)
        user = serializer.save()
        <span class="code-keyword">return</span> Response({
            <span class="code-string">'message'</span>: <span class="code-string">'Registration successful'</span>,
            <span class="code-string">'user'</span>: UserReadSerializer(user).data
        }, status=status.HTTP_201_CREATED)


<span class="code-keyword">class</span> <span class="code-class">MeView</span>(generics.RetrieveUpdateAPIView):
    <span class="code-string">"""
    Get or update current user profile.
    GET /api/auth/me/
    PATCH /api/auth/me/
    """</span>
    permission_classes = [permissions.IsAuthenticated]

    <span class="code-keyword">def</span> get_object(self):
        <span class="code-keyword">return</span> self.request.user

    <span class="code-keyword">def</span> get_serializer_class(self):
        <span class="code-keyword">if</span> self.request.method == <span class="code-string">'GET'</span>:
            <span class="code-keyword">return</span> UserReadSerializer
        <span class="code-keyword">return</span> UserUpdateSerializer


<span class="code-keyword">class</span> <span class="code-class">LogoutView</span>(APIView):
    <span class="code-string">"""
    Logout user (client should delete tokens).
    POST /api/auth/logout/
    """</span>
    permission_classes = [permissions.IsAuthenticated]

    <span class="code-keyword">def</span> post(self, request):
        <span class="code-comment"># Simple logout - client deletes tokens</span>
        <span class="code-keyword">return</span> Response({
            <span class="code-string">'message'</span>: <span class="code-string">'Logout successful'</span>
        }, status=status.HTTP_200_OK)</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="16">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create users/urls.py</div>
                            <div class="code-example"><code><span class="code-comment"># users/urls.py</span>
<span class="code-keyword">from</span> django.urls <span class="code-keyword">import</span> path
<span class="code-keyword">from</span> rest_framework_simplejwt.views <span class="code-keyword">import</span> (
    TokenObtainPairView,
    TokenRefreshView,
)
<span class="code-keyword">from</span> .views <span class="code-keyword">import</span> RegisterView, MeView, LogoutView

urlpatterns = [
    <span class="code-comment"># Registration</span>
    path(<span class="code-string">'register/'</span>, RegisterView.as_view(), name=<span class="code-string">'register'</span>),

    <span class="code-comment"># JWT Token endpoints</span>
    path(<span class="code-string">'login/'</span>, TokenObtainPairView.as_view(), name=<span class="code-string">'login'</span>),
    path(<span class="code-string">'token/refresh/'</span>, TokenRefreshView.as_view(), name=<span class="code-string">'token_refresh'</span>),

    <span class="code-comment"># User profile</span>
    path(<span class="code-string">'me/'</span>, MeView.as_view(), name=<span class="code-string">'me'</span>),
    path(<span class="code-string">'logout/'</span>, LogoutView.as_view(), name=<span class="code-string">'logout'</span>),
]</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="17">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Update mini_sbr/urls.py (main URLs)</div>
                            <div class="code-example"><code><span class="code-comment"># mini_sbr/urls.py</span>
<span class="code-keyword">from</span> django.contrib <span class="code-keyword">import</span> admin
<span class="code-keyword">from</span> django.urls <span class="code-keyword">import</span> path, include
<span class="code-keyword">from</span> django.conf <span class="code-keyword">import</span> settings
<span class="code-keyword">from</span> django.conf.urls.static <span class="code-keyword">import</span> static
<span class="code-keyword">from</span> drf_spectacular.views <span class="code-keyword">import</span> (
    SpectacularAPIView,
    SpectacularSwaggerView,
)

urlpatterns = [
    path(<span class="code-string">'admin/'</span>, admin.site.urls),

    <span class="code-comment"># API endpoints</span>
    path(<span class="code-string">'api/auth/'</span>, include(<span class="code-string">'apps.users.urls'</span>)),
    path(<span class="code-string">'api/companies/'</span>, include(<span class="code-string">'apps.companies.urls'</span>)),
    path(<span class="code-string">'api/candidates/'</span>, include(<span class="code-string">'apps.candidates.urls'</span>)),
    path(<span class="code-string">'api/jobs/'</span>, include(<span class="code-string">'apps.jobs.urls'</span>)),
    path(<span class="code-string">'api/applications/'</span>, include(<span class="code-string">'apps.applications.urls'</span>)),
    path(<span class="code-string">'api/dashboard/'</span>, include(<span class="code-string">'apps.dashboard.urls'</span>)),

    <span class="code-comment"># API Documentation</span>
    path(<span class="code-string">'api/schema/'</span>, SpectacularAPIView.as_view(), name=<span class="code-string">'schema'</span>),
    path(<span class="code-string">'api/docs/'</span>, SpectacularSwaggerView.as_view(url_name=<span class="code-string">'schema'</span>), name=<span class="code-string">'docs'</span>),
]

<span class="code-comment"># Serve media files in development</span>
<span class="code-keyword">if</span> settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="18">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Test auth endpoints (phone-based)</div>
                            <div class="task-detail"># Start server
python manage.py runserver

# Test Register (in another terminal) - using PHONE
curl -X POST http://localhost:8000/api/auth/register/ \
  -H "Content-Type: application/json" \
  -d '{"phone":"0501234567","password":"testpass123","password_confirm":"testpass123","role":"CANDIDATE"}'

# Test Login - using PHONE (not email)
curl -X POST http://localhost:8000/api/auth/login/ \
  -H "Content-Type: application/json" \
  -d '{"phone":"0501234567","password":"testpass123"}'

# Copy the access token and test /me/
curl http://localhost:8000/api/auth/me/ \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 3: Companies & Candidates -->
        <div class="phase phase-3">
            <div class="phase-header" onclick="togglePhase(this)">
                <div class="phase-number">3</div>
                <div class="phase-info">
                    <div class="phase-title">Companies & Candidates</div>
                    <div class="phase-desc">Profile models with BaseModel, file uploads, filters</div>
                </div>
                <span class="phase-status status-pending">Not Started</span>
                <span class="toggle-arrow">▼</span>
            </div>
            <div class="phase-content">
                <div class="learning-note">
                    <strong>What You'll Learn:</strong> Using BaseModel inheritance, file uploads,
                    model relationships, filtering, and the soft delete pattern in action.
                </div>

                <div class="task-group">
                    <div class="task-group-title">Companies App</div>

                    <div class="task" data-task="19">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create companies app</div>
                            <div class="task-detail">python manage.py startapp companies</div>
                        </div>
                    </div>

                    <div class="task" data-task="20">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Update companies/apps.py</div>
                            <div class="code-example"><code><span class="code-comment"># companies/apps.py</span>
<span class="code-keyword">from</span> django.apps <span class="code-keyword">import</span> AppConfig


<span class="code-keyword">class</span> <span class="code-class">CompaniesConfig</span>(AppConfig):
    default_auto_field = <span class="code-string">'django.db.models.BigAutoField'</span>
    name = <span class="code-string">'companies'</span></code></div>
                        </div>
                    </div>

                    <div class="task" data-task="21">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create companies/models.py <span class="task-tag tag-pattern">Pattern</span></div>
                            <div class="code-example"><code><span class="code-comment"># companies/models.py</span>
<span class="code-keyword">from</span> django.db <span class="code-keyword">import</span> models
<span class="code-keyword">from</span> libs.base_models <span class="code-keyword">import</span> BaseModel
<span class="code-keyword">from</span> libs.managers <span class="code-keyword">import</span> SoftDeleteManager, AllObjectsManager


<span class="code-keyword">class</span> <span class="code-class">Industry</span>(models.TextChoices):
    <span class="code-string">"""Industry types for companies"""</span>
    TECH = <span class="code-string">'TECH'</span>, <span class="code-string">'Technology'</span>
    CONSTRUCTION = <span class="code-string">'CONSTRUCTION'</span>, <span class="code-string">'Construction'</span>
    HEALTHCARE = <span class="code-string">'HEALTHCARE'</span>, <span class="code-string">'Healthcare'</span>
    FINANCE = <span class="code-string">'FINANCE'</span>, <span class="code-string">'Finance'</span>
    EDUCATION = <span class="code-string">'EDUCATION'</span>, <span class="code-string">'Education'</span>
    RETAIL = <span class="code-string">'RETAIL'</span>, <span class="code-string">'Retail'</span>
    OTHER = <span class="code-string">'OTHER'</span>, <span class="code-string">'Other'</span>


<span class="code-keyword">class</span> <span class="code-class">Company</span>(BaseModel):
    <span class="code-string">"""
    Company profile linked to a User with role=COMPANY.
    Inherits audit fields and soft delete from BaseModel.
    """</span>

    user = models.OneToOneField(
        <span class="code-string">'users.User'</span>,
        on_delete=models.CASCADE,
        related_name=<span class="code-string">'company'</span>
    )
    name = models.CharField(max_length=200)
    logo = models.ImageField(
        upload_to=<span class="code-string">'logos/'</span>,
        blank=True,
        null=True
    )
    industry = models.CharField(
        max_length=50,
        choices=Industry.choices,
        default=Industry.OTHER
    )
    description = models.TextField(blank=True)
    website = models.URLField(blank=True)
    location = models.CharField(max_length=100)

    <span class="code-comment"># Managers for soft delete pattern</span>
    objects = SoftDeleteManager()      <span class="code-comment"># Default: only active</span>
    all_objects = AllObjectsManager()  <span class="code-comment"># Include deleted</span>

    <span class="code-keyword">def</span> __str__(self):
        <span class="code-keyword">return</span> self.name

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        verbose_name_plural = <span class="code-string">'companies'</span></code></div>
                        </div>
                    </div>

                    <div class="task" data-task="22">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create companies/serializers.py</div>
                            <div class="code-example"><code><span class="code-comment"># companies/serializers.py</span>
<span class="code-keyword">from</span> rest_framework <span class="code-keyword">import</span> serializers
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> Company
<span class="code-keyword">from</span> apps.users.serializers <span class="code-keyword">import</span> UserReadSerializer


<span class="code-keyword">class</span> <span class="code-class">CompanyReadSerializer</span>(serializers.ModelSerializer):
    <span class="code-string">"""Serializer for reading company data"""</span>
    user = UserReadSerializer(read_only=True)

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Company
        fields = [
            <span class="code-string">'id'</span>, <span class="code-string">'user'</span>, <span class="code-string">'name'</span>, <span class="code-string">'logo'</span>, <span class="code-string">'industry'</span>,
            <span class="code-string">'description'</span>, <span class="code-string">'website'</span>, <span class="code-string">'location'</span>,
            <span class="code-string">'created_at'</span>, <span class="code-string">'updated_at'</span>
        ]
        read_only_fields = fields


<span class="code-keyword">class</span> <span class="code-class">CompanyWriteSerializer</span>(serializers.ModelSerializer):
    <span class="code-string">"""Serializer for creating/updating company"""</span>

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Company
        fields = [
            <span class="code-string">'name'</span>, <span class="code-string">'logo'</span>, <span class="code-string">'industry'</span>,
            <span class="code-string">'description'</span>, <span class="code-string">'website'</span>, <span class="code-string">'location'</span>
        ]

    <span class="code-keyword">def</span> create(self, validated_data):
        <span class="code-comment"># Automatically link to current user</span>
        user = self.context[<span class="code-string">'request'</span>].user
        validated_data[<span class="code-string">'user'</span>] = user
        validated_data[<span class="code-string">'created_by'</span>] = user
        <span class="code-keyword">return</span> super().create(validated_data)

    <span class="code-keyword">def</span> update(self, instance, validated_data):
        <span class="code-comment"># Track who updated</span>
        validated_data[<span class="code-string">'updated_by'</span>] = self.context[<span class="code-string">'request'</span>].user
        <span class="code-keyword">return</span> super().update(instance, validated_data)</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="23">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create companies/filters.py</div>
                            <div class="code-example"><code><span class="code-comment"># companies/filters.py</span>
<span class="code-keyword">import</span> django_filters
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> Company


<span class="code-keyword">class</span> <span class="code-class">CompanyFilter</span>(django_filters.FilterSet):
    <span class="code-string">"""Filter for companies list"""</span>

    name = django_filters.CharFilter(lookup_expr=<span class="code-string">'icontains'</span>)
    industry = django_filters.ChoiceFilter(choices=Company.Industry.choices)
    location = django_filters.CharFilter(lookup_expr=<span class="code-string">'icontains'</span>)

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Company
        fields = [<span class="code-string">'name'</span>, <span class="code-string">'industry'</span>, <span class="code-string">'location'</span>]</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="24">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create companies/views.py</div>
                            <div class="code-example"><code><span class="code-comment"># companies/views.py</span>
<span class="code-keyword">from</span> rest_framework <span class="code-keyword">import</span> viewsets, permissions, status
<span class="code-keyword">from</span> rest_framework.decorators <span class="code-keyword">import</span> action
<span class="code-keyword">from</span> rest_framework.response <span class="code-keyword">import</span> Response
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> Company
<span class="code-keyword">from</span> .serializers <span class="code-keyword">import</span> CompanyReadSerializer, CompanyWriteSerializer
<span class="code-keyword">from</span> .filters <span class="code-keyword">import</span> CompanyFilter


<span class="code-keyword">class</span> <span class="code-class">CompanyViewSet</span>(viewsets.ModelViewSet):
    <span class="code-string">"""
    ViewSet for Company CRUD operations.

    list:   GET /api/companies/         - List all companies
    create: POST /api/companies/        - Create company (auth required)
    read:   GET /api/companies/{id}/    - Get company detail
    update: PUT /api/companies/{id}/    - Update company
    delete: DELETE /api/companies/{id}/ - Soft delete company
    me:     GET /api/companies/me/      - Get current user's company
    """</span>
    queryset = Company.objects.all()
    filterset_class = CompanyFilter
    search_fields = [<span class="code-string">'name'</span>, <span class="code-string">'description'</span>]
    ordering_fields = [<span class="code-string">'name'</span>, <span class="code-string">'created_at'</span>]

    <span class="code-keyword">def</span> get_serializer_class(self):
        <span class="code-keyword">if</span> self.action <span class="code-keyword">in</span> [<span class="code-string">'create'</span>, <span class="code-string">'update'</span>, <span class="code-string">'partial_update'</span>]:
            <span class="code-keyword">return</span> CompanyWriteSerializer
        <span class="code-keyword">return</span> CompanyReadSerializer

    <span class="code-keyword">def</span> get_permissions(self):
        <span class="code-keyword">if</span> self.action <span class="code-keyword">in</span> [<span class="code-string">'list'</span>, <span class="code-string">'retrieve'</span>]:
            <span class="code-keyword">return</span> [permissions.AllowAny()]
        <span class="code-keyword">return</span> [permissions.IsAuthenticated()]

    @action(detail=False, methods=[<span class="code-string">'get'</span>])
    <span class="code-keyword">def</span> me(self, request):
        <span class="code-string">"""Get the current user's company profile"""</span>
        <span class="code-keyword">try</span>:
            company = request.user.company
            serializer = CompanyReadSerializer(company)
            <span class="code-keyword">return</span> Response(serializer.data)
        <span class="code-keyword">except</span> Company.DoesNotExist:
            <span class="code-keyword">return</span> Response(
                {<span class="code-string">'error'</span>: <span class="code-string">'No company profile found'</span>},
                status=status.HTTP_404_NOT_FOUND
            )

    <span class="code-keyword">def</span> perform_destroy(self, instance):
        <span class="code-string">"""Soft delete instead of hard delete"""</span>
        instance.soft_delete(user=self.request.user)</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="25">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create companies/urls.py</div>
                            <div class="code-example"><code><span class="code-comment"># companies/urls.py</span>
<span class="code-keyword">from</span> django.urls <span class="code-keyword">import</span> path, include
<span class="code-keyword">from</span> rest_framework.routers <span class="code-keyword">import</span> DefaultRouter
<span class="code-keyword">from</span> .views <span class="code-keyword">import</span> CompanyViewSet

router = DefaultRouter()
router.register(<span class="code-string">''</span>, CompanyViewSet, basename=<span class="code-string">'company'</span>)

urlpatterns = [
    path(<span class="code-string">''</span>, include(router.urls)),
]</code></div>
                        </div>
                    </div>
                </div>

                <div class="task-group">
                    <div class="task-group-title">Candidates App</div>

                    <div class="task" data-task="26">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create candidates app</div>
                            <div class="task-detail">python manage.py startapp candidates</div>
                        </div>
                    </div>

                    <div class="task" data-task="27">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Update candidates/apps.py</div>
                            <div class="code-example"><code><span class="code-comment"># candidates/apps.py</span>
<span class="code-keyword">from</span> django.apps <span class="code-keyword">import</span> AppConfig


<span class="code-keyword">class</span> <span class="code-class">CandidatesConfig</span>(AppConfig):
    default_auto_field = <span class="code-string">'django.db.models.BigAutoField'</span>
    name = <span class="code-string">'candidates'</span></code></div>
                        </div>
                    </div>

                    <div class="task" data-task="28">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create candidates/models.py <span class="task-tag tag-pattern">Pattern</span></div>
                            <div class="code-example"><code><span class="code-comment"># candidates/models.py</span>
<span class="code-keyword">from</span> django.db <span class="code-keyword">import</span> models
<span class="code-keyword">from</span> libs.base_models <span class="code-keyword">import</span> BaseModel
<span class="code-keyword">from</span> libs.managers <span class="code-keyword">import</span> SoftDeleteManager, AllObjectsManager


<span class="code-keyword">class</span> <span class="code-class">Candidate</span>(BaseModel):
    <span class="code-string">"""
    Candidate profile linked to a User with role=CANDIDATE.
    Inherits audit fields and soft delete from BaseModel.
    """</span>

    user = models.OneToOneField(
        <span class="code-string">'users.User'</span>,
        on_delete=models.CASCADE,
        related_name=<span class="code-string">'candidate'</span>
    )
    full_name = models.CharField(max_length=100)
    phone = models.CharField(max_length=20, blank=True)
    cv_file = models.FileField(
        upload_to=<span class="code-string">'cvs/'</span>,
        blank=True,
        null=True
    )
    skills = models.JSONField(
        default=list,
        help_text=<span class="code-string">'List of skills, e.g. ["Python", "Django"]'</span>
    )
    experience_years = models.PositiveIntegerField(default=0)
    location = models.CharField(max_length=100, blank=True)
    bio = models.TextField(blank=True)

    <span class="code-comment"># Managers for soft delete pattern</span>
    objects = SoftDeleteManager()
    all_objects = AllObjectsManager()

    <span class="code-keyword">def</span> __str__(self):
        <span class="code-keyword">return</span> self.full_name</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="29">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create candidates/serializers.py</div>
                            <div class="code-example"><code><span class="code-comment"># candidates/serializers.py</span>
<span class="code-keyword">from</span> rest_framework <span class="code-keyword">import</span> serializers
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> Candidate
<span class="code-keyword">from</span> apps.users.serializers <span class="code-keyword">import</span> UserReadSerializer


<span class="code-keyword">class</span> <span class="code-class">CandidateReadSerializer</span>(serializers.ModelSerializer):
    <span class="code-string">"""Serializer for reading candidate data"""</span>
    user = UserReadSerializer(read_only=True)

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Candidate
        fields = [
            <span class="code-string">'id'</span>, <span class="code-string">'user'</span>, <span class="code-string">'full_name'</span>, <span class="code-string">'phone'</span>, <span class="code-string">'cv_file'</span>,
            <span class="code-string">'skills'</span>, <span class="code-string">'experience_years'</span>, <span class="code-string">'location'</span>, <span class="code-string">'bio'</span>,
            <span class="code-string">'created_at'</span>, <span class="code-string">'updated_at'</span>
        ]
        read_only_fields = fields


<span class="code-keyword">class</span> <span class="code-class">CandidateWriteSerializer</span>(serializers.ModelSerializer):
    <span class="code-string">"""Serializer for creating/updating candidate"""</span>

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Candidate
        fields = [
            <span class="code-string">'full_name'</span>, <span class="code-string">'phone'</span>, <span class="code-string">'cv_file'</span>,
            <span class="code-string">'skills'</span>, <span class="code-string">'experience_years'</span>, <span class="code-string">'location'</span>, <span class="code-string">'bio'</span>
        ]

    <span class="code-keyword">def</span> create(self, validated_data):
        user = self.context[<span class="code-string">'request'</span>].user
        validated_data[<span class="code-string">'user'</span>] = user
        validated_data[<span class="code-string">'created_by'</span>] = user
        <span class="code-keyword">return</span> super().create(validated_data)

    <span class="code-keyword">def</span> update(self, instance, validated_data):
        validated_data[<span class="code-string">'updated_by'</span>] = self.context[<span class="code-string">'request'</span>].user
        <span class="code-keyword">return</span> super().update(instance, validated_data)</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="30">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create candidates/filters.py</div>
                            <div class="code-example"><code><span class="code-comment"># candidates/filters.py</span>
<span class="code-keyword">import</span> django_filters
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> Candidate


<span class="code-keyword">class</span> <span class="code-class">CandidateFilter</span>(django_filters.FilterSet):
    <span class="code-string">"""Filter for candidates list"""</span>

    full_name = django_filters.CharFilter(lookup_expr=<span class="code-string">'icontains'</span>)
    location = django_filters.CharFilter(lookup_expr=<span class="code-string">'icontains'</span>)
    min_experience = django_filters.NumberFilter(
        field_name=<span class="code-string">'experience_years'</span>,
        lookup_expr=<span class="code-string">'gte'</span>
    )
    max_experience = django_filters.NumberFilter(
        field_name=<span class="code-string">'experience_years'</span>,
        lookup_expr=<span class="code-string">'lte'</span>
    )

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Candidate
        fields = [<span class="code-string">'full_name'</span>, <span class="code-string">'location'</span>]</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="31">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create candidates/views.py</div>
                            <div class="code-example"><code><span class="code-comment"># candidates/views.py</span>
<span class="code-keyword">from</span> rest_framework <span class="code-keyword">import</span> viewsets, permissions, status
<span class="code-keyword">from</span> rest_framework.decorators <span class="code-keyword">import</span> action
<span class="code-keyword">from</span> rest_framework.response <span class="code-keyword">import</span> Response
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> Candidate
<span class="code-keyword">from</span> .serializers <span class="code-keyword">import</span> CandidateReadSerializer, CandidateWriteSerializer
<span class="code-keyword">from</span> .filters <span class="code-keyword">import</span> CandidateFilter


<span class="code-keyword">class</span> <span class="code-class">CandidateViewSet</span>(viewsets.ModelViewSet):
    <span class="code-string">"""
    ViewSet for Candidate CRUD operations.

    list:   GET /api/candidates/         - List candidates (companies only)
    create: POST /api/candidates/        - Create profile
    read:   GET /api/candidates/{id}/    - Get candidate detail
    update: PUT /api/candidates/{id}/    - Update profile
    delete: DELETE /api/candidates/{id}/ - Soft delete
    me:     GET /api/candidates/me/      - Get current user's profile
    """</span>
    queryset = Candidate.objects.all()
    filterset_class = CandidateFilter
    search_fields = [<span class="code-string">'full_name'</span>, <span class="code-string">'bio'</span>, <span class="code-string">'skills'</span>]
    ordering_fields = [<span class="code-string">'full_name'</span>, <span class="code-string">'experience_years'</span>, <span class="code-string">'created_at'</span>]

    <span class="code-keyword">def</span> get_serializer_class(self):
        <span class="code-keyword">if</span> self.action <span class="code-keyword">in</span> [<span class="code-string">'create'</span>, <span class="code-string">'update'</span>, <span class="code-string">'partial_update'</span>]:
            <span class="code-keyword">return</span> CandidateWriteSerializer
        <span class="code-keyword">return</span> CandidateReadSerializer

    <span class="code-keyword">def</span> get_permissions(self):
        <span class="code-keyword">if</span> self.action <span class="code-keyword">in</span> [<span class="code-string">'list'</span>, <span class="code-string">'retrieve'</span>]:
            <span class="code-comment"># Companies can view candidates</span>
            <span class="code-keyword">return</span> [permissions.IsAuthenticated()]
        <span class="code-keyword">return</span> [permissions.IsAuthenticated()]

    @action(detail=False, methods=[<span class="code-string">'get'</span>])
    <span class="code-keyword">def</span> me(self, request):
        <span class="code-string">"""Get the current user's candidate profile"""</span>
        <span class="code-keyword">try</span>:
            candidate = request.user.candidate
            serializer = CandidateReadSerializer(candidate)
            <span class="code-keyword">return</span> Response(serializer.data)
        <span class="code-keyword">except</span> Candidate.DoesNotExist:
            <span class="code-keyword">return</span> Response(
                {<span class="code-string">'error'</span>: <span class="code-string">'No candidate profile found'</span>},
                status=status.HTTP_404_NOT_FOUND
            )

    <span class="code-keyword">def</span> perform_destroy(self, instance):
        <span class="code-string">"""Soft delete instead of hard delete"""</span>
        instance.soft_delete(user=self.request.user)</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="32">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create candidates/urls.py</div>
                            <div class="code-example"><code><span class="code-comment"># candidates/urls.py</span>
<span class="code-keyword">from</span> django.urls <span class="code-keyword">import</span> path, include
<span class="code-keyword">from</span> rest_framework.routers <span class="code-keyword">import</span> DefaultRouter
<span class="code-keyword">from</span> .views <span class="code-keyword">import</span> CandidateViewSet

router = DefaultRouter()
router.register(<span class="code-string">''</span>, CandidateViewSet, basename=<span class="code-string">'candidate'</span>)

urlpatterns = [
    path(<span class="code-string">''</span>, include(router.urls)),
]</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="33">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Run migrations for companies and candidates</div>
                            <div class="task-detail">python manage.py makemigrations companies candidates
python manage.py migrate</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 4: Jobs & Applications -->
        <div class="phase phase-4">
            <div class="phase-header" onclick="togglePhase(this)">
                <div class="phase-number">4</div>
                <div class="phase-info">
                    <div class="phase-title">Jobs & Applications</div>
                    <div class="phase-desc">Job listings, applications, status flow, AI analysis</div>
                </div>
                <span class="phase-status status-pending">Not Started</span>
                <span class="toggle-arrow">▼</span>
            </div>
            <div class="phase-content">
                <div class="learning-note">
                    <strong>What You'll Learn:</strong> Complex model relationships, status workflows,
                    unique constraints, custom actions, and separating business logic into services.
                </div>

                <div class="task-group">
                    <div class="task-group-title">Jobs App</div>

                    <div class="task" data-task="34">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create jobs app</div>
                            <div class="task-detail">python manage.py startapp jobs</div>
                        </div>
                    </div>

                    <div class="task" data-task="35">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Update jobs/apps.py</div>
                            <div class="code-example"><code><span class="code-comment"># jobs/apps.py</span>
<span class="code-keyword">from</span> django.apps <span class="code-keyword">import</span> AppConfig


<span class="code-keyword">class</span> <span class="code-class">JobsConfig</span>(AppConfig):
    default_auto_field = <span class="code-string">'django.db.models.BigAutoField'</span>
    name = <span class="code-string">'jobs'</span></code></div>
                        </div>
                    </div>

                    <div class="task" data-task="36">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create jobs/models.py <span class="task-tag tag-pattern">Pattern</span></div>
                            <div class="code-example"><code><span class="code-comment"># jobs/models.py</span>
<span class="code-keyword">from</span> django.db <span class="code-keyword">import</span> models
<span class="code-keyword">from</span> libs.base_models <span class="code-keyword">import</span> BaseModel
<span class="code-keyword">from</span> libs.managers <span class="code-keyword">import</span> SoftDeleteManager, AllObjectsManager


<span class="code-keyword">class</span> <span class="code-class">EmploymentType</span>(models.TextChoices):
    <span class="code-string">"""Employment types for jobs"""</span>
    FULL_TIME = <span class="code-string">'FULL_TIME'</span>, <span class="code-string">'Full Time'</span>
    PART_TIME = <span class="code-string">'PART_TIME'</span>, <span class="code-string">'Part Time'</span>
    CONTRACT = <span class="code-string">'CONTRACT'</span>, <span class="code-string">'Contract'</span>
    INTERNSHIP = <span class="code-string">'INTERNSHIP'</span>, <span class="code-string">'Internship'</span>


<span class="code-keyword">class</span> <span class="code-class">Job</span>(BaseModel):
    <span class="code-string">"""
    Job posting linked to a Company.
    Inherits audit fields and soft delete from BaseModel.
    """</span>

    company = models.ForeignKey(
        <span class="code-string">'companies.Company'</span>,
        on_delete=models.CASCADE,
        related_name=<span class="code-string">'jobs'</span>
    )
    title = models.CharField(max_length=200)
    description = models.TextField()
    requirements = models.TextField()
    required_skills = models.JSONField(
        default=list,
        help_text=<span class="code-string">'Required skills, e.g. ["Python", "Django"]'</span>
    )
    employment_type = models.CharField(
        max_length=20,
        choices=EmploymentType.choices,
        default=EmploymentType.FULL_TIME
    )
    location = models.CharField(max_length=100)
    salary_min = models.DecimalField(
        max_digits=10,
        decimal_places=2,
        null=True,
        blank=True
    )
    salary_max = models.DecimalField(
        max_digits=10,
        decimal_places=2,
        null=True,
        blank=True
    )
    is_active = models.BooleanField(default=True)

    <span class="code-comment"># Managers</span>
    objects = SoftDeleteManager()
    all_objects = AllObjectsManager()

    <span class="code-keyword">def</span> __str__(self):
        <span class="code-keyword">return</span> f<span class="code-string">"{self.title} at {self.company.name}"</span>

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        ordering = [<span class="code-string">'-created_at'</span>]</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="37">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create jobs/serializers.py</div>
                            <div class="code-example"><code><span class="code-comment"># jobs/serializers.py</span>
<span class="code-keyword">from</span> rest_framework <span class="code-keyword">import</span> serializers
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> Job
<span class="code-keyword">from</span> apps.companies.serializers <span class="code-keyword">import</span> CompanyReadSerializer


<span class="code-keyword">class</span> <span class="code-class">JobReadSerializer</span>(serializers.ModelSerializer):
    <span class="code-string">"""Serializer for reading job data"""</span>
    company = CompanyReadSerializer(read_only=True)

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Job
        fields = [
            <span class="code-string">'id'</span>, <span class="code-string">'company'</span>, <span class="code-string">'title'</span>, <span class="code-string">'description'</span>,
            <span class="code-string">'requirements'</span>, <span class="code-string">'required_skills'</span>, <span class="code-string">'employment_type'</span>,
            <span class="code-string">'location'</span>, <span class="code-string">'salary_min'</span>, <span class="code-string">'salary_max'</span>, <span class="code-string">'is_active'</span>,
            <span class="code-string">'created_at'</span>, <span class="code-string">'updated_at'</span>
        ]
        read_only_fields = fields


<span class="code-keyword">class</span> <span class="code-class">JobListSerializer</span>(serializers.ModelSerializer):
    <span class="code-string">"""Lighter serializer for job list"""</span>
    company_name = serializers.CharField(source=<span class="code-string">'company.name'</span>, read_only=True)

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Job
        fields = [
            <span class="code-string">'id'</span>, <span class="code-string">'company_name'</span>, <span class="code-string">'title'</span>, <span class="code-string">'employment_type'</span>,
            <span class="code-string">'location'</span>, <span class="code-string">'salary_min'</span>, <span class="code-string">'salary_max'</span>, <span class="code-string">'is_active'</span>,
            <span class="code-string">'created_at'</span>
        ]


<span class="code-keyword">class</span> <span class="code-class">JobWriteSerializer</span>(serializers.ModelSerializer):
    <span class="code-string">"""Serializer for creating/updating jobs"""</span>

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Job
        fields = [
            <span class="code-string">'title'</span>, <span class="code-string">'description'</span>, <span class="code-string">'requirements'</span>,
            <span class="code-string">'required_skills'</span>, <span class="code-string">'employment_type'</span>, <span class="code-string">'location'</span>,
            <span class="code-string">'salary_min'</span>, <span class="code-string">'salary_max'</span>, <span class="code-string">'is_active'</span>
        ]

    <span class="code-keyword">def</span> create(self, validated_data):
        user = self.context[<span class="code-string">'request'</span>].user
        <span class="code-comment"># Get the user's company</span>
        validated_data[<span class="code-string">'company'</span>] = user.company
        validated_data[<span class="code-string">'created_by'</span>] = user
        <span class="code-keyword">return</span> super().create(validated_data)

    <span class="code-keyword">def</span> update(self, instance, validated_data):
        validated_data[<span class="code-string">'updated_by'</span>] = self.context[<span class="code-string">'request'</span>].user
        <span class="code-keyword">return</span> super().update(instance, validated_data)</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="38">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create jobs/filters.py</div>
                            <div class="code-example"><code><span class="code-comment"># jobs/filters.py</span>
<span class="code-keyword">import</span> django_filters
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> Job


<span class="code-keyword">class</span> <span class="code-class">JobFilter</span>(django_filters.FilterSet):
    <span class="code-string">"""Filter for jobs list"""</span>

    title = django_filters.CharFilter(lookup_expr=<span class="code-string">'icontains'</span>)
    company = django_filters.NumberFilter(field_name=<span class="code-string">'company__id'</span>)
    employment_type = django_filters.ChoiceFilter(
        choices=Job.EmploymentType.choices
    )
    location = django_filters.CharFilter(lookup_expr=<span class="code-string">'icontains'</span>)
    is_active = django_filters.BooleanFilter()
    min_salary = django_filters.NumberFilter(
        field_name=<span class="code-string">'salary_min'</span>,
        lookup_expr=<span class="code-string">'gte'</span>
    )

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Job
        fields = [<span class="code-string">'title'</span>, <span class="code-string">'company'</span>, <span class="code-string">'employment_type'</span>, <span class="code-string">'location'</span>, <span class="code-string">'is_active'</span>]</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="39">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create jobs/views.py</div>
                            <div class="code-example"><code><span class="code-comment"># jobs/views.py</span>
<span class="code-keyword">from</span> rest_framework <span class="code-keyword">import</span> viewsets, permissions, status
<span class="code-keyword">from</span> rest_framework.decorators <span class="code-keyword">import</span> action
<span class="code-keyword">from</span> rest_framework.response <span class="code-keyword">import</span> Response
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> Job
<span class="code-keyword">from</span> .serializers <span class="code-keyword">import</span> JobReadSerializer, JobListSerializer, JobWriteSerializer
<span class="code-keyword">from</span> .filters <span class="code-keyword">import</span> JobFilter


<span class="code-keyword">class</span> <span class="code-class">JobViewSet</span>(viewsets.ModelViewSet):
    <span class="code-string">"""
    ViewSet for Job CRUD operations.

    list:       GET /api/jobs/              - List jobs (public)
    create:     POST /api/jobs/             - Create job (company only)
    read:       GET /api/jobs/{id}/         - Get job detail (public)
    update:     PUT /api/jobs/{id}/         - Update job
    delete:     DELETE /api/jobs/{id}/      - Soft delete job
    activate:   POST /api/jobs/{id}/activate/   - Activate job
    deactivate: POST /api/jobs/{id}/deactivate/ - Deactivate job
    """</span>
    queryset = Job.objects.filter(is_active=True)
    filterset_class = JobFilter
    search_fields = [<span class="code-string">'title'</span>, <span class="code-string">'description'</span>, <span class="code-string">'required_skills'</span>]
    ordering_fields = [<span class="code-string">'title'</span>, <span class="code-string">'created_at'</span>, <span class="code-string">'salary_min'</span>]

    <span class="code-keyword">def</span> get_queryset(self):
        <span class="code-comment"># Companies see all their jobs, others see only active</span>
        user = self.request.user
        <span class="code-keyword">if</span> user.is_authenticated <span class="code-keyword">and</span> hasattr(user, <span class="code-string">'company'</span>):
            <span class="code-keyword">return</span> Job.objects.filter(company=user.company)
        <span class="code-keyword">return</span> Job.objects.filter(is_active=True)

    <span class="code-keyword">def</span> get_serializer_class(self):
        <span class="code-keyword">if</span> self.action == <span class="code-string">'list'</span>:
            <span class="code-keyword">return</span> JobListSerializer
        <span class="code-keyword">if</span> self.action <span class="code-keyword">in</span> [<span class="code-string">'create'</span>, <span class="code-string">'update'</span>, <span class="code-string">'partial_update'</span>]:
            <span class="code-keyword">return</span> JobWriteSerializer
        <span class="code-keyword">return</span> JobReadSerializer

    <span class="code-keyword">def</span> get_permissions(self):
        <span class="code-keyword">if</span> self.action <span class="code-keyword">in</span> [<span class="code-string">'list'</span>, <span class="code-string">'retrieve'</span>]:
            <span class="code-keyword">return</span> [permissions.AllowAny()]
        <span class="code-keyword">return</span> [permissions.IsAuthenticated()]

    @action(detail=True, methods=[<span class="code-string">'post'</span>])
    <span class="code-keyword">def</span> activate(self, request, pk=None):
        <span class="code-string">"""Activate a job posting"""</span>
        job = self.get_object()
        job.is_active = True
        job.save(update_fields=[<span class="code-string">'is_active'</span>])
        <span class="code-keyword">return</span> Response({<span class="code-string">'message'</span>: <span class="code-string">'Job activated'</span>})

    @action(detail=True, methods=[<span class="code-string">'post'</span>])
    <span class="code-keyword">def</span> deactivate(self, request, pk=None):
        <span class="code-string">"""Deactivate a job posting"""</span>
        job = self.get_object()
        job.is_active = False
        job.save(update_fields=[<span class="code-string">'is_active'</span>])
        <span class="code-keyword">return</span> Response({<span class="code-string">'message'</span>: <span class="code-string">'Job deactivated'</span>})

    <span class="code-keyword">def</span> perform_destroy(self, instance):
        instance.soft_delete(user=self.request.user)</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="40">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create jobs/urls.py</div>
                            <div class="code-example"><code><span class="code-comment"># jobs/urls.py</span>
<span class="code-keyword">from</span> django.urls <span class="code-keyword">import</span> path, include
<span class="code-keyword">from</span> rest_framework.routers <span class="code-keyword">import</span> DefaultRouter
<span class="code-keyword">from</span> .views <span class="code-keyword">import</span> JobViewSet

router = DefaultRouter()
router.register(<span class="code-string">''</span>, JobViewSet, basename=<span class="code-string">'job'</span>)

urlpatterns = [
    path(<span class="code-string">''</span>, include(router.urls)),
]</code></div>
                        </div>
                    </div>
                </div>

                <div class="task-group">
                    <div class="task-group-title">Applications App</div>

                    <div class="task" data-task="41">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create applications app</div>
                            <div class="task-detail">python manage.py startapp applications</div>
                        </div>
                    </div>

                    <div class="task" data-task="42">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Update applications/apps.py</div>
                            <div class="code-example"><code><span class="code-comment"># applications/apps.py</span>
<span class="code-keyword">from</span> django.apps <span class="code-keyword">import</span> AppConfig


<span class="code-keyword">class</span> <span class="code-class">ApplicationsConfig</span>(AppConfig):
    default_auto_field = <span class="code-string">'django.db.models.BigAutoField'</span>
    name = <span class="code-string">'applications'</span></code></div>
                        </div>
                    </div>

                    <div class="task" data-task="43">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create applications/models.py <span class="task-tag tag-pattern">Pattern</span></div>
                            <div class="code-example"><code><span class="code-comment"># applications/models.py</span>
<span class="code-keyword">from</span> django.db <span class="code-keyword">import</span> models
<span class="code-keyword">from</span> libs.base_models <span class="code-keyword">import</span> BaseModel
<span class="code-keyword">from</span> libs.managers <span class="code-keyword">import</span> SoftDeleteManager, AllObjectsManager


<span class="code-keyword">class</span> <span class="code-class">ApplicationStatus</span>(models.TextChoices):
    <span class="code-string">"""Status choices for job applications"""</span>
    PENDING = <span class="code-string">'PENDING'</span>, <span class="code-string">'Pending'</span>
    REVIEWED = <span class="code-string">'REVIEWED'</span>, <span class="code-string">'Reviewed'</span>
    SHORTLISTED = <span class="code-string">'SHORTLISTED'</span>, <span class="code-string">'Shortlisted'</span>
    REJECTED = <span class="code-string">'REJECTED'</span>, <span class="code-string">'Rejected'</span>
    HIRED = <span class="code-string">'HIRED'</span>, <span class="code-string">'Hired'</span>


<span class="code-keyword">class</span> <span class="code-class">Application</span>(BaseModel):
    <span class="code-string">"""
    Job application linking Candidate to Job.
    Includes AI analysis results.
    """</span>

    candidate = models.ForeignKey(
        <span class="code-string">'candidates.Candidate'</span>,
        on_delete=models.CASCADE,
        related_name=<span class="code-string">'applications'</span>
    )
    job = models.ForeignKey(
        <span class="code-string">'jobs.Job'</span>,
        on_delete=models.CASCADE,
        related_name=<span class="code-string">'applications'</span>
    )
    status = models.CharField(
        max_length=20,
        choices=ApplicationStatus.choices,
        default=ApplicationStatus.PENDING
    )
    cover_letter = models.TextField(blank=True)

    <span class="code-comment"># AI Analysis results</span>
    ai_score = models.PositiveIntegerField(null=True, blank=True)
    ai_analysis = models.JSONField(null=True, blank=True)

    <span class="code-comment"># Managers</span>
    objects = SoftDeleteManager()
    all_objects = AllObjectsManager()

    <span class="code-keyword">def</span> __str__(self):
        <span class="code-keyword">return</span> f<span class="code-string">"{self.candidate.full_name} - {self.job.title}"</span>

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        <span class="code-comment"># Prevent duplicate applications</span>
        unique_together = [<span class="code-string">'candidate'</span>, <span class="code-string">'job'</span>]
        ordering = [<span class="code-string">'-created_at'</span>]</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="44">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create applications/serializers.py</div>
                            <div class="code-example"><code><span class="code-comment"># applications/serializers.py</span>
<span class="code-keyword">from</span> rest_framework <span class="code-keyword">import</span> serializers
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> Application
<span class="code-keyword">from</span> apps.candidates.serializers <span class="code-keyword">import</span> CandidateReadSerializer
<span class="code-keyword">from</span> apps.jobs.serializers <span class="code-keyword">import</span> JobListSerializer


<span class="code-keyword">class</span> <span class="code-class">ApplicationReadSerializer</span>(serializers.ModelSerializer):
    <span class="code-string">"""Serializer for reading application data"""</span>
    candidate = CandidateReadSerializer(read_only=True)
    job = JobListSerializer(read_only=True)

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Application
        fields = [
            <span class="code-string">'id'</span>, <span class="code-string">'candidate'</span>, <span class="code-string">'job'</span>, <span class="code-string">'status'</span>,
            <span class="code-string">'cover_letter'</span>, <span class="code-string">'ai_score'</span>, <span class="code-string">'ai_analysis'</span>,
            <span class="code-string">'created_at'</span>, <span class="code-string">'updated_at'</span>
        ]
        read_only_fields = fields


<span class="code-keyword">class</span> <span class="code-class">ApplicationListSerializer</span>(serializers.ModelSerializer):
    <span class="code-string">"""Lighter serializer for application list"""</span>
    candidate_name = serializers.CharField(
        source=<span class="code-string">'candidate.full_name'</span>,
        read_only=True
    )
    job_title = serializers.CharField(
        source=<span class="code-string">'job.title'</span>,
        read_only=True
    )

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Application
        fields = [
            <span class="code-string">'id'</span>, <span class="code-string">'candidate_name'</span>, <span class="code-string">'job_title'</span>, <span class="code-string">'status'</span>,
            <span class="code-string">'ai_score'</span>, <span class="code-string">'created_at'</span>
        ]


<span class="code-keyword">class</span> <span class="code-class">ApplicationWriteSerializer</span>(serializers.ModelSerializer):
    <span class="code-string">"""Serializer for creating applications"""</span>

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Application
        fields = [<span class="code-string">'job'</span>, <span class="code-string">'cover_letter'</span>]

    <span class="code-keyword">def</span> validate_job(self, value):
        <span class="code-string">"""Check job is active"""</span>
        <span class="code-keyword">if not</span> value.is_active:
            <span class="code-keyword">raise</span> serializers.ValidationError(<span class="code-string">'This job is no longer active'</span>)
        <span class="code-keyword">return</span> value

    <span class="code-keyword">def</span> create(self, validated_data):
        user = self.context[<span class="code-string">'request'</span>].user
        validated_data[<span class="code-string">'candidate'</span>] = user.candidate
        validated_data[<span class="code-string">'created_by'</span>] = user
        <span class="code-keyword">return</span> super().create(validated_data)


<span class="code-keyword">class</span> <span class="code-class">ApplicationStatusSerializer</span>(serializers.ModelSerializer):
    <span class="code-string">"""Serializer for updating application status"""</span>

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Application
        fields = [<span class="code-string">'status'</span>]</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="45">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create applications/services/ directory and AI service <span class="task-tag tag-new">New</span></div>
                            <div class="task-detail">mkdir -p applications/services
touch applications/services/__init__.py</div>
                        </div>
                    </div>

                    <div class="task" data-task="46">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create applications/services/ai_service.py <span class="task-tag tag-learn">Learn</span></div>
                            <div class="code-example"><code><span class="code-comment"># applications/services/ai_service.py</span>
<span class="code-keyword">import</span> random


<span class="code-keyword">class</span> <span class="code-class">AIAnalysisService</span>:
    <span class="code-string">"""
    Dummy AI service for analyzing candidate-job match.

    In production, this would:
    - Parse CV using NLP
    - Compare skills using ML models
    - Call external AI APIs (OpenAI, etc.)

    For now, we simulate the analysis.
    """</span>

    @staticmethod
    <span class="code-keyword">def</span> analyze(application):
        <span class="code-string">"""
        Analyze a candidate's fit for a job.

        Args:
            application: Application instance

        Returns:
            tuple: (ai_score: int, ai_analysis: dict)
        """</span>
        candidate = application.candidate
        job = application.job

        <span class="code-comment"># Calculate skill match</span>
        candidate_skills = set(
            s.lower() <span class="code-keyword">for</span> s <span class="code-keyword">in</span> (candidate.skills <span class="code-keyword">or</span> [])
        )
        job_skills = set(
            s.lower() <span class="code-keyword">for</span> s <span class="code-keyword">in</span> (job.required_skills <span class="code-keyword">or</span> [])
        )

        <span class="code-keyword">if</span> job_skills:
            matching_skills = candidate_skills & job_skills
            skill_match = len(matching_skills) / len(job_skills) * 100
        <span class="code-keyword">else</span>:
            matching_skills = set()
            skill_match = 50  <span class="code-comment"># Default if no skills required</span>

        <span class="code-comment"># Simulate experience score</span>
        experience_match = min(100, candidate.experience_years * 15)

        <span class="code-comment"># Simulate education score (random for demo)</span>
        education_match = random.randint(60, 95)

        <span class="code-comment"># Calculate weighted overall score</span>
        ai_score = int(
            (skill_match * 0.5) +
            (experience_match * 0.3) +
            (education_match * 0.2)
        )

        <span class="code-comment"># Build analysis report</span>
        ai_analysis = {
            <span class="code-string">'skill_match'</span>: round(skill_match),
            <span class="code-string">'experience_match'</span>: round(experience_match),
            <span class="code-string">'education_match'</span>: education_match,
            <span class="code-string">'matching_skills'</span>: list(matching_skills)[:5],
            <span class="code-string">'missing_skills'</span>: list(job_skills - candidate_skills)[:3],
            <span class="code-string">'strengths'</span>: AIAnalysisService._get_strengths(candidate),
            <span class="code-string">'recommendation'</span>: AIAnalysisService._get_recommendation(ai_score),
            <span class="code-string">'confidence'</span>: round(random.uniform(0.70, 0.95), 2)
        }

        <span class="code-keyword">return</span> ai_score, ai_analysis

    @staticmethod
    <span class="code-keyword">def</span> _get_strengths(candidate):
        <span class="code-string">"""Generate strengths based on candidate profile"""</span>
        strengths = []
        <span class="code-keyword">if</span> candidate.experience_years >= 5:
            strengths.append(<span class="code-string">'Experienced professional'</span>)
        <span class="code-keyword">if</span> len(candidate.skills <span class="code-keyword">or</span> []) >= 5:
            strengths.append(<span class="code-string">'Diverse skill set'</span>)
        <span class="code-keyword">if</span> candidate.cv_file:
            strengths.append(<span class="code-string">'CV provided'</span>)
        <span class="code-keyword">return</span> strengths <span class="code-keyword">or</span> [<span class="code-string">'Eager to learn'</span>]

    @staticmethod
    <span class="code-keyword">def</span> _get_recommendation(score):
        <span class="code-string">"""Generate recommendation based on score"""</span>
        <span class="code-keyword">if</span> score >= 80:
            <span class="code-keyword">return</span> <span class="code-string">'Strong candidate - recommend for interview'</span>
        <span class="code-keyword">elif</span> score >= 60:
            <span class="code-keyword">return</span> <span class="code-string">'Good fit - consider for interview'</span>
        <span class="code-keyword">elif</span> score >= 40:
            <span class="code-keyword">return</span> <span class="code-string">'Potential candidate - may need training'</span>
        <span class="code-keyword">else</span>:
            <span class="code-keyword">return</span> <span class="code-string">'Skills gap - not recommended'</span></code></div>
                        </div>
                    </div>

                    <div class="task" data-task="47">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create applications/filters.py</div>
                            <div class="code-example"><code><span class="code-comment"># applications/filters.py</span>
<span class="code-keyword">import</span> django_filters
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> Application, ApplicationStatus


<span class="code-keyword">class</span> <span class="code-class">ApplicationFilter</span>(django_filters.FilterSet):
    <span class="code-string">"""Filter for applications list"""</span>

    status = django_filters.ChoiceFilter(choices=ApplicationStatus.choices)
    job = django_filters.NumberFilter(field_name=<span class="code-string">'job__id'</span>)
    candidate = django_filters.NumberFilter(field_name=<span class="code-string">'candidate__id'</span>)
    min_score = django_filters.NumberFilter(
        field_name=<span class="code-string">'ai_score'</span>,
        lookup_expr=<span class="code-string">'gte'</span>
    )

    <span class="code-keyword">class</span> <span class="code-class">Meta</span>:
        model = Application
        fields = [<span class="code-string">'status'</span>, <span class="code-string">'job'</span>, <span class="code-string">'candidate'</span>]</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="48">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create applications/views.py</div>
                            <div class="code-example"><code><span class="code-comment"># applications/views.py</span>
<span class="code-keyword">from</span> rest_framework <span class="code-keyword">import</span> viewsets, permissions, status
<span class="code-keyword">from</span> rest_framework.decorators <span class="code-keyword">import</span> action
<span class="code-keyword">from</span> rest_framework.response <span class="code-keyword">import</span> Response
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> Application
<span class="code-keyword">from</span> .serializers <span class="code-keyword">import</span> (
    ApplicationReadSerializer,
    ApplicationListSerializer,
    ApplicationWriteSerializer,
    ApplicationStatusSerializer
)
<span class="code-keyword">from</span> .filters <span class="code-keyword">import</span> ApplicationFilter
<span class="code-keyword">from</span> .services.ai_service <span class="code-keyword">import</span> AIAnalysisService


<span class="code-keyword">class</span> <span class="code-class">ApplicationViewSet</span>(viewsets.ModelViewSet):
    <span class="code-string">"""
    ViewSet for Application CRUD operations.

    list:          GET /api/applications/           - List applications
    create:        POST /api/applications/          - Apply to job (candidate)
    read:          GET /api/applications/{id}/      - Get application detail
    update_status: PATCH /api/applications/{id}/status/ - Update status (company)
    analyze:       POST /api/applications/{id}/analyze/ - Run AI analysis
    """</span>
    queryset = Application.objects.all()
    filterset_class = ApplicationFilter
    ordering_fields = [<span class="code-string">'created_at'</span>, <span class="code-string">'ai_score'</span>, <span class="code-string">'status'</span>]

    <span class="code-keyword">def</span> get_queryset(self):
        <span class="code-string">"""Filter based on user role"""</span>
        user = self.request.user
        <span class="code-keyword">if</span> hasattr(user, <span class="code-string">'candidate'</span>):
            <span class="code-comment"># Candidates see their own applications</span>
            <span class="code-keyword">return</span> Application.objects.filter(candidate=user.candidate)
        <span class="code-keyword">elif</span> hasattr(user, <span class="code-string">'company'</span>):
            <span class="code-comment"># Companies see applications to their jobs</span>
            <span class="code-keyword">return</span> Application.objects.filter(job__company=user.company)
        <span class="code-comment"># Admin sees all</span>
        <span class="code-keyword">return</span> Application.objects.all()

    <span class="code-keyword">def</span> get_serializer_class(self):
        <span class="code-keyword">if</span> self.action == <span class="code-string">'list'</span>:
            <span class="code-keyword">return</span> ApplicationListSerializer
        <span class="code-keyword">if</span> self.action == <span class="code-string">'create'</span>:
            <span class="code-keyword">return</span> ApplicationWriteSerializer
        <span class="code-keyword">if</span> self.action == <span class="code-string">'update_status'</span>:
            <span class="code-keyword">return</span> ApplicationStatusSerializer
        <span class="code-keyword">return</span> ApplicationReadSerializer

    @action(detail=True, methods=[<span class="code-string">'patch'</span>], url_path=<span class="code-string">'status'</span>)
    <span class="code-keyword">def</span> update_status(self, request, pk=None):
        <span class="code-string">"""Update application status (companies only)"""</span>
        application = self.get_object()
        serializer = ApplicationStatusSerializer(
            application,
            data=request.data,
            partial=True
        )
        serializer.is_valid(raise_exception=True)
        serializer.save(updated_by=request.user)
        <span class="code-keyword">return</span> Response(ApplicationReadSerializer(application).data)

    @action(detail=True, methods=[<span class="code-string">'post'</span>])
    <span class="code-keyword">def</span> analyze(self, request, pk=None):
        <span class="code-string">"""
        Run AI analysis on application.
        POST /api/applications/{id}/analyze/
        """</span>
        application = self.get_object()

        <span class="code-comment"># Run AI analysis</span>
        ai_score, ai_analysis = AIAnalysisService.analyze(application)

        <span class="code-comment"># Save results</span>
        application.ai_score = ai_score
        application.ai_analysis = ai_analysis
        application.save(update_fields=[<span class="code-string">'ai_score'</span>, <span class="code-string">'ai_analysis'</span>])

        <span class="code-keyword">return</span> Response({
            <span class="code-string">'ai_score'</span>: ai_score,
            <span class="code-string">'ai_analysis'</span>: ai_analysis
        })

    <span class="code-keyword">def</span> perform_destroy(self, instance):
        instance.soft_delete(user=self.request.user)</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="49">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create applications/urls.py</div>
                            <div class="code-example"><code><span class="code-comment"># applications/urls.py</span>
<span class="code-keyword">from</span> django.urls <span class="code-keyword">import</span> path, include
<span class="code-keyword">from</span> rest_framework.routers <span class="code-keyword">import</span> DefaultRouter
<span class="code-keyword">from</span> .views <span class="code-keyword">import</span> ApplicationViewSet

router = DefaultRouter()
router.register(<span class="code-string">''</span>, ApplicationViewSet, basename=<span class="code-string">'application'</span>)

urlpatterns = [
    path(<span class="code-string">''</span>, include(router.urls)),
]</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="50">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Run migrations for jobs and applications</div>
                            <div class="task-detail">python manage.py makemigrations jobs applications
python manage.py migrate</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 5: Dashboard & Polish -->
        <div class="phase phase-5">
            <div class="phase-header" onclick="togglePhase(this)">
                <div class="phase-number">5</div>
                <div class="phase-info">
                    <div class="phase-title">Dashboard & Final Polish</div>
                    <div class="phase-desc">Analytics, seed data, API docs, testing</div>
                </div>
                <span class="phase-status status-pending">Not Started</span>
                <span class="toggle-arrow">▼</span>
            </div>
            <div class="phase-content">
                <div class="learning-note">
                    <strong>What You'll Learn:</strong> Aggregation queries, management commands,
                    API documentation with Swagger, and preparing for production.
                </div>

                <div class="task-group">
                    <div class="task-group-title">Dashboard App</div>

                    <div class="task" data-task="51">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create dashboard app</div>
                            <div class="task-detail">python manage.py startapp dashboard</div>
                        </div>
                    </div>

                    <div class="task" data-task="52">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Update dashboard/apps.py</div>
                            <div class="code-example"><code><span class="code-comment"># dashboard/apps.py</span>
<span class="code-keyword">from</span> django.apps <span class="code-keyword">import</span> AppConfig


<span class="code-keyword">class</span> <span class="code-class">DashboardConfig</span>(AppConfig):
    default_auto_field = <span class="code-string">'django.db.models.BigAutoField'</span>
    name = <span class="code-string">'dashboard'</span></code></div>
                        </div>
                    </div>

                    <div class="task" data-task="53">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create dashboard/views.py <span class="task-tag tag-learn">Learn</span></div>
                            <div class="code-example"><code><span class="code-comment"># dashboard/views.py</span>
<span class="code-keyword">from</span> django.db.models <span class="code-keyword">import</span> Count, Avg
<span class="code-keyword">from</span> rest_framework <span class="code-keyword">import</span> permissions
<span class="code-keyword">from</span> rest_framework.views <span class="code-keyword">import</span> APIView
<span class="code-keyword">from</span> rest_framework.response <span class="code-keyword">import</span> Response
<span class="code-keyword">from</span> apps.users.models <span class="code-keyword">import</span> User
<span class="code-keyword">from</span> apps.companies.models <span class="code-keyword">import</span> Company
<span class="code-keyword">from</span> apps.candidates.models <span class="code-keyword">import</span> Candidate
<span class="code-keyword">from</span> apps.jobs.models <span class="code-keyword">import</span> Job
<span class="code-keyword">from</span> apps.applications.models <span class="code-keyword">import</span> Application


<span class="code-keyword">class</span> <span class="code-class">AdminDashboardView</span>(APIView):
    <span class="code-string">"""
    Dashboard stats for admin users.
    GET /api/dashboard/admin/
    """</span>
    permission_classes = [permissions.IsAdminUser]

    <span class="code-keyword">def</span> get(self, request):
        <span class="code-keyword">return</span> Response({
            <span class="code-string">'users'</span>: {
                <span class="code-string">'total'</span>: User.objects.count(),
                <span class="code-string">'by_role'</span>: dict(
                    User.objects.values(<span class="code-string">'role'</span>)
                    .annotate(count=Count(<span class="code-string">'id'</span>))
                    .values_list(<span class="code-string">'role'</span>, <span class="code-string">'count'</span>)
                )
            },
            <span class="code-string">'companies'</span>: Company.objects.count(),
            <span class="code-string">'candidates'</span>: Candidate.objects.count(),
            <span class="code-string">'jobs'</span>: {
                <span class="code-string">'total'</span>: Job.objects.count(),
                <span class="code-string">'active'</span>: Job.objects.filter(is_active=True).count()
            },
            <span class="code-string">'applications'</span>: {
                <span class="code-string">'total'</span>: Application.objects.count(),
                <span class="code-string">'by_status'</span>: dict(
                    Application.objects.values(<span class="code-string">'status'</span>)
                    .annotate(count=Count(<span class="code-string">'id'</span>))
                    .values_list(<span class="code-string">'status'</span>, <span class="code-string">'count'</span>)
                ),
                <span class="code-string">'avg_ai_score'</span>: Application.objects.filter(
                    ai_score__isnull=False
                ).aggregate(avg=Avg(<span class="code-string">'ai_score'</span>))[<span class="code-string">'avg'</span>]
            }
        })


<span class="code-keyword">class</span> <span class="code-class">CompanyDashboardView</span>(APIView):
    <span class="code-string">"""
    Dashboard stats for company users.
    GET /api/dashboard/company/
    """</span>
    permission_classes = [permissions.IsAuthenticated]

    <span class="code-keyword">def</span> get(self, request):
        <span class="code-keyword">try</span>:
            company = request.user.company
        <span class="code-keyword">except</span> Company.DoesNotExist:
            <span class="code-keyword">return</span> Response({<span class="code-string">'error'</span>: <span class="code-string">'No company profile'</span>}, status=404)

        jobs = Job.objects.filter(company=company)
        applications = Application.objects.filter(job__company=company)

        <span class="code-keyword">return</span> Response({
            <span class="code-string">'jobs'</span>: {
                <span class="code-string">'total'</span>: jobs.count(),
                <span class="code-string">'active'</span>: jobs.filter(is_active=True).count()
            },
            <span class="code-string">'applications'</span>: {
                <span class="code-string">'total'</span>: applications.count(),
                <span class="code-string">'by_status'</span>: dict(
                    applications.values(<span class="code-string">'status'</span>)
                    .annotate(count=Count(<span class="code-string">'id'</span>))
                    .values_list(<span class="code-string">'status'</span>, <span class="code-string">'count'</span>)
                ),
                <span class="code-string">'pending'</span>: applications.filter(status=<span class="code-string">'PENDING'</span>).count(),
                <span class="code-string">'avg_ai_score'</span>: applications.filter(
                    ai_score__isnull=False
                ).aggregate(avg=Avg(<span class="code-string">'ai_score'</span>))[<span class="code-string">'avg'</span>]
            },
            <span class="code-string">'top_candidates'</span>: list(
                applications.filter(ai_score__isnull=False)
                .order_by(<span class="code-string">'-ai_score'</span>)[:5]
                .values(<span class="code-string">'id'</span>, <span class="code-string">'candidate__full_name'</span>, <span class="code-string">'ai_score'</span>)
            )
        })


<span class="code-keyword">class</span> <span class="code-class">CandidateDashboardView</span>(APIView):
    <span class="code-string">"""
    Dashboard stats for candidate users.
    GET /api/dashboard/candidate/
    """</span>
    permission_classes = [permissions.IsAuthenticated]

    <span class="code-keyword">def</span> get(self, request):
        <span class="code-keyword">try</span>:
            candidate = request.user.candidate
        <span class="code-keyword">except</span> Candidate.DoesNotExist:
            <span class="code-keyword">return</span> Response({<span class="code-string">'error'</span>: <span class="code-string">'No candidate profile'</span>}, status=404)

        applications = candidate.applications.all()

        <span class="code-keyword">return</span> Response({
            <span class="code-string">'profile_complete'</span>: bool(candidate.cv_file <span class="code-keyword">and</span> candidate.skills),
            <span class="code-string">'applications'</span>: {
                <span class="code-string">'total'</span>: applications.count(),
                <span class="code-string">'by_status'</span>: dict(
                    applications.values(<span class="code-string">'status'</span>)
                    .annotate(count=Count(<span class="code-string">'id'</span>))
                    .values_list(<span class="code-string">'status'</span>, <span class="code-string">'count'</span>)
                ),
                <span class="code-string">'avg_ai_score'</span>: applications.filter(
                    ai_score__isnull=False
                ).aggregate(avg=Avg(<span class="code-string">'ai_score'</span>))[<span class="code-string">'avg'</span>]
            },
            <span class="code-string">'recent_applications'</span>: list(
                applications.order_by(<span class="code-string">'-created_at'</span>)[:5]
                .values(<span class="code-string">'id'</span>, <span class="code-string">'job__title'</span>, <span class="code-string">'status'</span>, <span class="code-string">'ai_score'</span>)
            ),
            <span class="code-string">'available_jobs'</span>: Job.objects.filter(is_active=True).count()
        })</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="54">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create dashboard/urls.py</div>
                            <div class="code-example"><code><span class="code-comment"># dashboard/urls.py</span>
<span class="code-keyword">from</span> django.urls <span class="code-keyword">import</span> path
<span class="code-keyword">from</span> .views <span class="code-keyword">import</span> (
    AdminDashboardView,
    CompanyDashboardView,
    CandidateDashboardView
)

urlpatterns = [
    path(<span class="code-string">'admin/'</span>, AdminDashboardView.as_view(), name=<span class="code-string">'admin-dashboard'</span>),
    path(<span class="code-string">'company/'</span>, CompanyDashboardView.as_view(), name=<span class="code-string">'company-dashboard'</span>),
    path(<span class="code-string">'candidate/'</span>, CandidateDashboardView.as_view(), name=<span class="code-string">'candidate-dashboard'</span>),
]</code></div>
                        </div>
                    </div>
                </div>

                <div class="task-group">
                    <div class="task-group-title">Seed Data Command</div>

                    <div class="task" data-task="55">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create management command directory</div>
                            <div class="task-detail">mkdir -p users/management/commands
touch users/management/__init__.py
touch users/management/commands/__init__.py</div>
                        </div>
                    </div>

                    <div class="task" data-task="56">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create users/management/commands/seed_data.py <span class="task-tag tag-learn">Learn</span></div>
                            <div class="code-example"><code><span class="code-comment"># users/management/commands/seed_data.py</span>
<span class="code-comment"># Seed data with phone-based users</span>
<span class="code-keyword">from</span> django.core.management.base <span class="code-keyword">import</span> BaseCommand
<span class="code-keyword">from</span> apps.users.models <span class="code-keyword">import</span> User, UserRole
<span class="code-keyword">from</span> apps.companies.models <span class="code-keyword">import</span> Company, Industry
<span class="code-keyword">from</span> apps.candidates.models <span class="code-keyword">import</span> Candidate
<span class="code-keyword">from</span> apps.jobs.models <span class="code-keyword">import</span> Job, EmploymentType


<span class="code-keyword">class</span> <span class="code-class">Command</span>(BaseCommand):
    help = <span class="code-string">'Seed database with sample data'</span>

    <span class="code-keyword">def</span> handle(self, *args, **options):
        self.stdout.write(<span class="code-string">'Seeding database...'</span>)

        <span class="code-comment"># Create admin - using PHONE</span>
        admin, created = User.objects.get_or_create(
            phone=<span class="code-string">'0501111111'</span>,
            defaults={
                <span class="code-string">'role'</span>: UserRole.ADMIN,
                <span class="code-string">'is_staff'</span>: True,
                <span class="code-string">'is_superuser'</span>: True
            }
        )
        <span class="code-keyword">if</span> created:
            admin.set_password(<span class="code-string">'password123'</span>)
            admin.save()
            self.stdout.write(f<span class="code-string">'Created admin: {admin.phone}'</span>)

        <span class="code-comment"># Create companies - using PHONE</span>
        companies_data = [
            {
                <span class="code-string">'phone'</span>: <span class="code-string">'0502222222'</span>,
                <span class="code-string">'name'</span>: <span class="code-string">'TechCorp Arabia'</span>,
                <span class="code-string">'industry'</span>: Industry.TECH,
                <span class="code-string">'location'</span>: <span class="code-string">'Riyadh'</span>,
                <span class="code-string">'description'</span>: <span class="code-string">'Leading tech company in Saudi Arabia'</span>
            },
            {
                <span class="code-string">'phone'</span>: <span class="code-string">'0502222223'</span>,
                <span class="code-string">'name'</span>: <span class="code-string">'BuildIt Construction'</span>,
                <span class="code-string">'industry'</span>: Industry.CONSTRUCTION,
                <span class="code-string">'location'</span>: <span class="code-string">'Jeddah'</span>,
                <span class="code-string">'description'</span>: <span class="code-string">'Major construction company'</span>
            },
        ]

        <span class="code-keyword">for</span> data <span class="code-keyword">in</span> companies_data:
            user, created = User.objects.get_or_create(
                phone=data[<span class="code-string">'phone'</span>],
                defaults={<span class="code-string">'role'</span>: UserRole.COMPANY}
            )
            <span class="code-keyword">if</span> created:
                user.set_password(<span class="code-string">'password123'</span>)
                user.save()
                Company.objects.create(
                    user=user,
                    name=data[<span class="code-string">'name'</span>],
                    industry=data[<span class="code-string">'industry'</span>],
                    location=data[<span class="code-string">'location'</span>],
                    description=data[<span class="code-string">'description'</span>],
                    created_by=admin
                )
                self.stdout.write(f<span class="code-string">'Created company: {data["name"]}'</span>)

        <span class="code-comment"># Create candidates - using PHONE</span>
        candidates_data = [
            {
                <span class="code-string">'phone'</span>: <span class="code-string">'0503333333'</span>,
                <span class="code-string">'full_name'</span>: <span class="code-string">'Ahmed Al-Rashid'</span>,
                <span class="code-string">'skills'</span>: [<span class="code-string">'Python'</span>, <span class="code-string">'Django'</span>, <span class="code-string">'REST APIs'</span>, <span class="code-string">'PostgreSQL'</span>],
                <span class="code-string">'experience_years'</span>: 5,
                <span class="code-string">'location'</span>: <span class="code-string">'Riyadh'</span>
            },
            {
                <span class="code-string">'phone'</span>: <span class="code-string">'0504444444'</span>,
                <span class="code-string">'full_name'</span>: <span class="code-string">'Fatima Hassan'</span>,
                <span class="code-string">'skills'</span>: [<span class="code-string">'Project Management'</span>, <span class="code-string">'Agile'</span>, <span class="code-string">'Leadership'</span>],
                <span class="code-string">'experience_years'</span>: 8,
                <span class="code-string">'location'</span>: <span class="code-string">'Jeddah'</span>
            },
        ]

        <span class="code-keyword">for</span> data <span class="code-keyword">in</span> candidates_data:
            user, created = User.objects.get_or_create(
                phone=data[<span class="code-string">'phone'</span>],
                defaults={<span class="code-string">'role'</span>: UserRole.CANDIDATE}
            )
            <span class="code-keyword">if</span> created:
                user.set_password(<span class="code-string">'password123'</span>)
                user.save()
                Candidate.objects.create(
                    user=user,
                    full_name=data[<span class="code-string">'full_name'</span>],
                    skills=data[<span class="code-string">'skills'</span>],
                    experience_years=data[<span class="code-string">'experience_years'</span>],
                    location=data[<span class="code-string">'location'</span>],
                    created_by=admin
                )
                self.stdout.write(f<span class="code-string">'Created candidate: {data["full_name"]}'</span>)

        <span class="code-comment"># Create jobs</span>
        techcorp = Company.objects.filter(name=<span class="code-string">'TechCorp Arabia'</span>).first()
        <span class="code-keyword">if</span> techcorp:
            jobs_data = [
                {
                    <span class="code-string">'title'</span>: <span class="code-string">'Senior Python Developer'</span>,
                    <span class="code-string">'description'</span>: <span class="code-string">'We are looking for a senior Python developer...'</span>,
                    <span class="code-string">'requirements'</span>: <span class="code-string">'5+ years Python, Django experience'</span>,
                    <span class="code-string">'required_skills'</span>: [<span class="code-string">'Python'</span>, <span class="code-string">'Django'</span>, <span class="code-string">'REST APIs'</span>, <span class="code-string">'PostgreSQL'</span>],
                    <span class="code-string">'employment_type'</span>: EmploymentType.FULL_TIME,
                    <span class="code-string">'location'</span>: <span class="code-string">'Riyadh'</span>,
                    <span class="code-string">'salary_min'</span>: 15000,
                    <span class="code-string">'salary_max'</span>: 25000
                },
                {
                    <span class="code-string">'title'</span>: <span class="code-string">'Data Analyst'</span>,
                    <span class="code-string">'description'</span>: <span class="code-string">'Analyze data to drive business decisions...'</span>,
                    <span class="code-string">'requirements'</span>: <span class="code-string">'3+ years data analysis experience'</span>,
                    <span class="code-string">'required_skills'</span>: [<span class="code-string">'SQL'</span>, <span class="code-string">'Python'</span>, <span class="code-string">'Tableau'</span>, <span class="code-string">'Excel'</span>],
                    <span class="code-string">'employment_type'</span>: EmploymentType.FULL_TIME,
                    <span class="code-string">'location'</span>: <span class="code-string">'Riyadh'</span>,
                    <span class="code-string">'salary_min'</span>: 12000,
                    <span class="code-string">'salary_max'</span>: 18000
                },
            ]

            <span class="code-keyword">for</span> data <span class="code-keyword">in</span> jobs_data:
                job, created = Job.objects.get_or_create(
                    company=techcorp,
                    title=data[<span class="code-string">'title'</span>],
                    defaults={**data, <span class="code-string">'created_by'</span>: admin}
                )
                <span class="code-keyword">if</span> created:
                    self.stdout.write(f<span class="code-string">'Created job: {data["title"]}'</span>)

        self.stdout.write(
            self.style.SUCCESS(<span class="code-string">'Database seeded successfully!'</span>)
        )

<span class="code-comment"># Test accounts after seeding:</span>
<span class="code-comment"># Admin:     0501111111 / password123</span>
<span class="code-comment"># Company:   0502222222 / password123 (TechCorp Arabia)</span>
<span class="code-comment"># Candidate: 0503333333 / password123 (Ahmed)</span>
<span class="code-comment"># Candidate: 0504444444 / password123 (Fatima)</span></code></div>
                        </div>
                    </div>

                    <div class="task" data-task="57">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Run seed command</div>
                            <div class="task-detail">python manage.py seed_data</div>
                        </div>
                    </div>
                </div>

                <div class="task-group">
                    <div class="task-group-title">Final Polish</div>

                    <div class="task" data-task="58">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Create .gitignore</div>
                            <div class="code-example"><code><span class="code-comment"># .gitignore</span>

<span class="code-comment"># Python</span>
__pycache__/
*.py[cod]
*.so
.Python
venv/
env/

<span class="code-comment"># Django</span>
*.log
local_settings.py
db.sqlite3
media/

<span class="code-comment"># Environment</span>
.env
.env.local

<span class="code-comment"># IDE</span>
.vscode/
.idea/
*.swp
*.swo

<span class="code-comment"># OS</span>
.DS_Store
Thumbs.db</code></div>
                        </div>
                    </div>

                    <div class="task" data-task="59">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Test all endpoints</div>
                            <div class="task-detail"># Start server
python manage.py runserver

# Visit Swagger docs
open http://localhost:8000/api/docs/

# Test accounts (after running seed_data):
# Login uses PHONE number
# Admin:     0501111111 / password123
# Company:   0502222222 / password123 (TechCorp Arabia)
# Candidate: 0503333333 / password123 (Ahmed)
# Candidate: 0504444444 / password123 (Fatima)</div>
                        </div>
                    </div>

                    <div class="task" data-task="60">
                        <div class="task-check" onclick="toggleTask(this)"></div>
                        <div class="task-content">
                            <div class="task-title">Initial git commit</div>
                            <div class="task-detail">git init
git add .
git commit -m "feat: initial Mini-SBR implementation"</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Requirements Section -->
        <div class="requirements">
            <h3>Requirements (requirements.txt)</h3>
            <div class="req-list">
                <div class="req-item"><span>Django</span>==5.0.1</div>
                <div class="req-item"><span>djangorestframework</span>==3.14.0</div>
                <div class="req-item"><span>djangorestframework-simplejwt</span>==5.3.1</div>
                <div class="req-item"><span>django-cors-headers</span>==4.3.1</div>
                <div class="req-item"><span>django-filter</span>==23.5</div>
                <div class="req-item"><span>django-environ</span>==0.11.2</div>
                <div class="req-item"><span>drf-spectacular</span>==0.27.0</div>
                <div class="req-item"><span>Pillow</span>==10.2.0</div>
                <div class="req-item"><span>black</span>==24.1.0 (dev)</div>
                <div class="req-item"><span>isort</span>==5.13.2 (dev)</div>
                <div class="req-item"><span>flake8</span>==7.0.0 (dev)</div>
            </div>
        </div>
    </div>

    <script>
        // Toggle phase expansion
        function togglePhase(header) {
            const phase = header.parentElement;
            phase.classList.toggle('expanded');
        }

        // Toggle task completion
        function toggleTask(checkbox) {
            checkbox.classList.toggle('checked');
            const task = checkbox.closest('.task');
            task.classList.toggle('done');

            // Save to localStorage
            saveProgress();
            updateProgress();
            updatePhaseStatus();
        }

        // Save progress to localStorage
        function saveProgress() {
            const tasks = document.querySelectorAll('.task');
            const completed = [];

            tasks.forEach(task => {
                if (task.classList.contains('done')) {
                    completed.push(task.dataset.task);
                }
            });

            localStorage.setItem('miniSbrProgress', JSON.stringify(completed));
        }

        // Load progress from localStorage
        function loadProgress() {
            const saved = localStorage.getItem('miniSbrProgress');
            if (saved) {
                const completed = JSON.parse(saved);
                completed.forEach(taskId => {
                    const task = document.querySelector(`[data-task="${taskId}"]`);
                    if (task) {
                        task.classList.add('done');
                        task.querySelector('.task-check').classList.add('checked');
                    }
                });
            }
            updateProgress();
            updatePhaseStatus();
        }

        // Update progress bar
        function updateProgress() {
            const total = document.querySelectorAll('.task').length;
            const completed = document.querySelectorAll('.task.done').length;
            const percent = Math.round((completed / total) * 100);

            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('progressPercent').textContent = percent + '%';
            document.getElementById('progressBar').style.width = percent + '%';
        }

        // Update phase status badges
        function updatePhaseStatus() {
            document.querySelectorAll('.phase').forEach(phase => {
                const tasks = phase.querySelectorAll('.task');
                const completed = phase.querySelectorAll('.task.done');
                const status = phase.querySelector('.phase-status');

                if (completed.length === 0) {
                    status.className = 'phase-status status-pending';
                    status.textContent = 'Not Started';
                } else if (completed.length === tasks.length) {
                    status.className = 'phase-status status-done';
                    status.textContent = 'Completed';
                } else {
                    status.className = 'phase-status status-progress';
                    status.textContent = `${completed.length}/${tasks.length}`;
                }
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', loadProgress);
    </script>
</body>
</html>
